<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【Pandas】掌管数据挖掘的神 | SilverSucks</title><meta name="author" content="Jason"><meta name="copyright" content="Jason"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pandas补充 为什么要补充？因为这篇文章总结的是23年左右的知识点，随着Pandas的不断更新以及更多业务场景的不断涌现，Pandas知识点就需要扩充了，而且重要的都标了⭐️，Respect！！  ⭐️⭐️Pandas案例1234567891011121314151617181920212223"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://liamjohnson-w.github.io/2024/08/12/2024.08.12/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【Pandas】掌管数据挖掘的神',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-04 19:50:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"> <script src="/live2d-widget/autoload.js"></script><script src="/live2d-widget/autoload.js"> </script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/tx.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">234</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">58</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-gamepad"></i><span> Games</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mikutap/"><i class="fa-fw fa fa-music"></i><span> MikuTap 初音未来</span></a></li><li><a class="site-page child" href="/starbattle/"><i class="fa-fw fa fa-space-shuttle"></i><span> StartBattle 星际大战</span></a></li><li><a class="site-page child" href="/2048/"><i class="fa-fw fa fa-flag"></i><span> 2048 经典游戏</span></a></li><li><a class="site-page child" href="/battlecity/"><i class="fa-fw fa fa-arrow-circle-left"></i><span> BattleCity 坦克大战</span></a></li><li><a class="site-page child" href="/pacman/"><i class="fa-fw fa fa-bolt"></i><span> PacMan  吃豆人</span></a></li><li><a class="site-page child" href="/tetris/"><i class="fa-fw fa fa-arrows-alt"></i><span> Tetris 俄罗斯方块</span></a></li><li><a class="site-page child" href="/smallcat/"><i class="fa-fw fa fa-paw"></i><span> CatchCat 困住小猫</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-leaf"></i><span> Moments</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/diary/"><i class="fa-fw fas fa-bookmark"></i><span> Diary</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa fa-hourglass-half"></i><span> Gallery</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-podcast"></i><span> More</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags标签</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About关于</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-bookmark"></i><span> Messageboard留言板</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/%E8%83%8C%E6%99%AF%20(2).png')"><nav id="nav"><span id="blog-info"><a href="/" title="SilverSucks"><span class="site-name">SilverSucks</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-gamepad"></i><span> Games</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/mikutap/"><i class="fa-fw fa fa-music"></i><span> MikuTap 初音未来</span></a></li><li><a class="site-page child" href="/starbattle/"><i class="fa-fw fa fa-space-shuttle"></i><span> StartBattle 星际大战</span></a></li><li><a class="site-page child" href="/2048/"><i class="fa-fw fa fa-flag"></i><span> 2048 经典游戏</span></a></li><li><a class="site-page child" href="/battlecity/"><i class="fa-fw fa fa-arrow-circle-left"></i><span> BattleCity 坦克大战</span></a></li><li><a class="site-page child" href="/pacman/"><i class="fa-fw fa fa-bolt"></i><span> PacMan  吃豆人</span></a></li><li><a class="site-page child" href="/tetris/"><i class="fa-fw fa fa-arrows-alt"></i><span> Tetris 俄罗斯方块</span></a></li><li><a class="site-page child" href="/smallcat/"><i class="fa-fw fa fa-paw"></i><span> CatchCat 困住小猫</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-leaf"></i><span> Moments</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/diary/"><i class="fa-fw fas fa-bookmark"></i><span> Diary</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa fa-hourglass-half"></i><span> Gallery</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-podcast"></i><span> More</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags标签</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About关于</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-bookmark"></i><span> Messageboard留言板</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【Pandas】掌管数据挖掘的神</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-11T16:00:00.000Z" title="Created 2024-08-12 00:00:00">2024-08-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-07-04T11:50:52.235Z" title="Updated 2025-07-04 19:50:52">2025-07-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【Pandas】掌管数据挖掘的神"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Pandas补充"><a href="#Pandas补充" class="headerlink" title="Pandas补充"></a>Pandas补充</h1><blockquote>
<p>为什么要补充？因为这篇文章总结的是23年左右的知识点，随着Pandas的不断更新以及更多业务场景的不断涌现，Pandas知识点就需要扩充了，而且重要的都标了⭐️，Respect！！</p>
</blockquote>
<h2 id="⭐️⭐️Pandas案例"><a href="#⭐️⭐️Pandas案例" class="headerlink" title="⭐️⭐️Pandas案例"></a>⭐️⭐️Pandas案例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;Arial Unicode MS&#x27;</span>]    </span><br><span class="line"><span class="comment"># 如果是Mac本, 不支持SimHei的时候, 可以修改为 &#x27;Microsoft YaHei&#x27; 或者 &#x27;Arial Unicode MS&#x27;\n</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"><span class="comment"># 设置显示风格</span></span><br><span class="line">plt.style.use(<span class="string">&#x27;fivethirtyeight&#x27;</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取整个csv文件封装成DataFrame</span></span><br><span class="line">df = pd.read_csv(<span class="string">&quot;/Users/lifuyao/PycharmProjects/pythonProject/Files/1960-2019全球GDP数据.csv&quot;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line"><span class="comment"># 只筛选中国的数据</span></span><br><span class="line">china_df = df[df.country==<span class="string">&quot;中国&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置年份为index（因为之前的是按照序号作为索引 inplace=True：直接修改原 DataFrame，而不是返回一个新的 DataFrame。</span></span><br><span class="line">china_df.set_index(<span class="string">&#x27;year&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">china_df.rename(columns=&#123;<span class="string">&#x27;GDP&#x27;</span>:<span class="string">&#x27;中国&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">china_df.中国.plot(legend=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">usa_df = df[df.country==<span class="string">&quot;美国&quot;</span>]</span><br><span class="line">usa_df.set_index(<span class="string">&#x27;year&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">usa_df.rename(columns=&#123;<span class="string">&#x27;GDP&#x27;</span>:<span class="string">&#x27;美国&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">usa_df.美国.plot(legend=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jp_df = df[df.country==<span class="string">&quot;日本&quot;</span>]</span><br><span class="line">jp_df.set_index(<span class="string">&#x27;year&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">jp_df.rename(columns=&#123;<span class="string">&#x27;GDP&#x27;</span>:<span class="string">&#x27;日本&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">jp_df.日本.plot(legend=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<p>绘图展示 ：</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250629211403477.png" alt="image-20250629211403477"></p>
<h2 id="⭐️⭐️⭐️Series"><a href="#⭐️⭐️⭐️Series" class="headerlink" title="⭐️⭐️⭐️Series"></a>⭐️⭐️⭐️Series</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><blockquote>
<p>Series是什么？可以理解为向量</p>
<p>创建Series的方式呢？</p>
<ul>
<li>通过列表、字典、元组都可以作为pd.Series()的数据输入</li>
<li>也可以使用numpy的arange函数也可以作为pd.Series()的数据输入</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Series能够传入Python中的列表，元组和字典, 而且可以自定义index,index指定必须为列表</span></span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">s2 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"></span><br><span class="line">s3 = pd.Series((<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>), index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"></span><br><span class="line">s4 = pd.Series(&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;)</span><br><span class="line">s5 = pd.Series(np.arange(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">s6 = pd.Series(data=[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)], index=[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;ABCDE&#x27;</span>])</span><br><span class="line">s6</span><br></pre></td></tr></table></figure>



<h3 id="Series属性和方法"><a href="#Series属性和方法" class="headerlink" title="Series属性和方法"></a>Series属性和方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 练习Series的属性和方法(index, values, 根据索引获取value)</span></span><br><span class="line"><span class="built_in">print</span>(s6.index)</span><br><span class="line"><span class="built_in">print</span>(s6.values)</span><br><span class="line">s6[<span class="string">&#x27;E&#x27;</span>]</span><br><span class="line">s6[<span class="string">&#x27;E&#x27;</span>] = <span class="number">99</span></span><br><span class="line">s6[<span class="string">&#x27;E&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h2 id="⭐️⭐️⭐️DataFrame"><a href="#⭐️⭐️⭐️DataFrame" class="headerlink" title="⭐️⭐️⭐️DataFrame"></a>⭐️⭐️⭐️DataFrame</h2><h3 id="创建DataFrame"><a href="#创建DataFrame" class="headerlink" title="创建DataFrame"></a>创建DataFrame</h3><blockquote>
<p>DataFrame是一个类似于二维数组或表格(如excel)的对象，既有行索引，又有列索引</p>
<ul>
<li>行索引，表明不同行，横向索引，叫index，0轴，axis&#x3D;0</li>
<li>列索引，表名不同列，纵向索引，叫columns，1轴，axis&#x3D;1</li>
</ul>
</blockquote>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250630102430897.png" alt="image-20250630102430897"></p>
<blockquote>
<p>同Series一样，DataFrame也可以接收多种类型的数据并封装成DataFrame。</p>
<ul>
<li>从文件中读取：pd.read_csv(‘csv格式数据文件路径’)</li>
<li>列表嵌套字典</li>
<li>列表嵌套元组</li>
<li><code>通过ndarray创建DataFrame</code><ul>
<li>想想numpy的创建Ndarray方法？</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建DataFrame的三种方式，</span></span><br><span class="line"><span class="comment"># 列表嵌套字典(每个键值对是一列数据)，列表嵌套元组(每个元组是一行数据)，通过Numpy的ndarray创建</span></span><br><span class="line">infoData=&#123;<span class="string">&#x27;name&#x27;</span>:[<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;赵六&#x27;</span>],</span><br><span class="line">          <span class="string">&#x27;gender&#x27;</span>:[<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;女&#x27;</span>],</span><br><span class="line">          <span class="string">&#x27;age&#x27;</span>:[<span class="number">54</span>,<span class="number">45</span>,<span class="number">67</span>,<span class="number">30</span>]&#125;</span><br><span class="line"><span class="built_in">print</span>(pd.DataFrame(data=infoData))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表嵌套元组</span></span><br><span class="line">info = [</span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">39</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">40</span>),</span><br><span class="line">(<span class="string">&#x27;王五&#x27;</span>,<span class="string">&#x27;女&#x27;</span>,<span class="number">20</span>)]</span><br><span class="line">df2 = pd.DataFrame(data=info, columns=[<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;性别&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>])</span><br><span class="line">df2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过ndarray创建DataFrame</span></span><br><span class="line">arr1 = np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">df3 = pd.DataFrame(data=arr1, columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df3</span><br></pre></td></tr></table></figure>

<h3 id="DataFrame属性"><a href="#DataFrame属性" class="headerlink" title="DataFrame属性"></a>DataFrame属性</h3><ul>
<li><p>查看shape属性</p>
<ul>
<li>data.shape</li>
</ul>
</li>
<li><p>查看index属性</p>
<ul>
<li>data.index</li>
</ul>
</li>
<li><p>查看 columns </p>
<ul>
<li>data.columns</li>
</ul>
</li>
<li><p>查看values</p>
<ul>
<li>data.values</li>
</ul>
</li>
<li><p>转置</p>
<ul>
<li>data.T</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个示例DataFrame</span></span><br><span class="line">data = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;姓名&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;年龄&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>, <span class="number">28</span>],</span><br><span class="line">    <span class="string">&#x27;城市&#x27;</span>: [<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;原始DataFrame:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nshape属性(行数,列数):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.shape)  <span class="comment"># 输出: (3, 3)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nindex属性(行索引):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.index)  <span class="comment"># 输出: RangeIndex(start=0, stop=3, step=1)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\ncolumns属性(列名):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.columns)  <span class="comment"># 输出: Index([&#x27;姓名&#x27;, &#x27;年龄&#x27;, &#x27;城市&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nvalues属性(底层numpy数组):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.values)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">输出:</span></span><br><span class="line"><span class="string">[[&#x27;张三&#x27; 25 &#x27;北京&#x27;]</span></span><br><span class="line"><span class="string"> [&#x27;李四&#x27; 30 &#x27;上海&#x27;]</span></span><br><span class="line"><span class="string"> [&#x27;王五&#x27; 28 &#x27;广州&#x27;]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n转置后的DataFrame:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.T)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">输出:</span></span><br><span class="line"><span class="string">         0    1    2</span></span><br><span class="line"><span class="string">姓名    张三   李四   王五</span></span><br><span class="line"><span class="string">年龄    25   30   28</span></span><br><span class="line"><span class="string">城市   北京  上海  广州</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="DataFrame对象方法"><a href="#DataFrame对象方法" class="headerlink" title="DataFrame对象方法"></a>DataFrame对象方法</h3><blockquote>
<p>对于大型数据集，可以先查看部分数据</p>
<ul>
<li>large_data &#x3D; pd.read_csv(‘big_dataset.csv’)</li>
<li>print(large_data.head(10))  # 查看前10行了解数据结构</li>
<li>print(large_data.tail(8))   <em># 查看后8行检查数据完整性</em></li>
</ul>
</blockquote>
<ul>
<li>显示前n行内容<ul>
<li>head(n)</li>
</ul>
</li>
<li>显示后n行内容(如果不补充参数，默认5行。填入参数n则显示后n行)<ul>
<li>data.tail(5)</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个包含20行数据的DataFrame</span></span><br><span class="line">data = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;ID&#x27;</span>: <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">21</span>),</span><br><span class="line">    <span class="string">&#x27;Value&#x27;</span>: [i*<span class="number">10</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">21</span>)],</span><br><span class="line">    <span class="string">&#x27;Category&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]*<span class="number">6</span> + [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;完整DataFrame (20行):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看前5行(默认)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n默认head() - 前5行:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.head())</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   ID  Value Category</span></span><br><span class="line"><span class="string">0   1     10        A</span></span><br><span class="line"><span class="string">1   2     20        B</span></span><br><span class="line"><span class="string">2   3     30        C</span></span><br><span class="line"><span class="string">3   4     40        A</span></span><br><span class="line"><span class="string">4   5     50        B</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看前3行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nhead(3) - 前3行:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.head(<span class="number">3</span>))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   ID  Value Category</span></span><br><span class="line"><span class="string">0   1     10        A</span></span><br><span class="line"><span class="string">1   2     20        B</span></span><br><span class="line"><span class="string">2   3     30        C</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看后5行(默认)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n默认tail() - 后5行:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.tail())</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ID  Value Category</span></span><br><span class="line"><span class="string">15  16    160        A</span></span><br><span class="line"><span class="string">16  17    170        B</span></span><br><span class="line"><span class="string">17  18    180        C</span></span><br><span class="line"><span class="string">18  19    190        A</span></span><br><span class="line"><span class="string">19  20    200        B</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看后3行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\ntail(3) - 后3行:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.tail(<span class="number">3</span>))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ID  Value Category</span></span><br><span class="line"><span class="string">17  18    180        C</span></span><br><span class="line"><span class="string">18  19    190        A</span></span><br><span class="line"><span class="string">19  20    200        B</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="DatatFrame索引的设置"><a href="#DatatFrame索引的设置" class="headerlink" title="DatatFrame索引的设置"></a>DatatFrame索引的设置</h3><p>需求：</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250630104653161.png" alt="image-20250630104653161"></p>
<ul>
<li>1- 修改行列索引值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stu = [<span class="string">&quot;学生_&quot;</span> + <span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(score_df.shape[<span class="number">0</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必须整体全部修改</span></span><br><span class="line">data.index = stu</span><br></pre></td></tr></table></figure>

<p>注意：以下修改方式是错误的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误修改方式</span></span><br><span class="line">data.index[<span class="number">3</span>] = <span class="string">&#x27;学生_3&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2- 重设索引<ul>
<li>reset_index(drop&#x3D;False)<ul>
<li>设置新的下标索引</li>
<li>drop:默认为False，不删除原来索引，如果为True,删除原来的索引值</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重置索引,drop=False</span></span><br><span class="line">data.reset_index()</span><br></pre></td></tr></table></figure>

<ul>
<li>以某列值设置为新的索引<ul>
<li>set_index(keys, drop&#x3D;True)<ul>
<li><strong>keys</strong> : 列索引名成或者列索引名称的列表</li>
<li><strong>drop</strong> : boolean, default True.当做新的索引，删除原来的列</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重置索引,drop=True</span></span><br><span class="line">data.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;month&#x27;</span>: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>],</span><br><span class="line">                    <span class="string">&#x27;year&#x27;</span>: [<span class="number">2012</span>, <span class="number">2014</span>, <span class="number">2013</span>, <span class="number">2014</span>],</span><br><span class="line">                    <span class="string">&#x27;sale&#x27;</span>:[<span class="number">55</span>, <span class="number">40</span>, <span class="number">84</span>, <span class="number">31</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#    month  sale  year</span></span><br><span class="line"><span class="comment"># 0  1      55    2012</span></span><br><span class="line"><span class="comment"># 1  4      40    2014</span></span><br><span class="line"><span class="comment"># 2  7      84    2013</span></span><br><span class="line"><span class="comment"># 3  10     31    2014</span></span><br><span class="line"></span><br><span class="line">df.set_index(<span class="string">&#x27;month&#x27;</span>)</span><br><span class="line"><span class="comment">#        sale  year</span></span><br><span class="line"><span class="comment"># month</span></span><br><span class="line"><span class="comment"># 1      55    2012</span></span><br><span class="line"><span class="comment"># 4      40    2014</span></span><br><span class="line"><span class="comment"># 7      84    2013</span></span><br><span class="line"><span class="comment"># 10     31    2014</span></span><br><span class="line"></span><br><span class="line">df = df.set_index([<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="comment">#             sale</span></span><br><span class="line"><span class="comment"># year  month</span></span><br><span class="line"><span class="comment"># 2012  1     55</span></span><br><span class="line"><span class="comment"># 2014  4     40</span></span><br><span class="line"><span class="comment"># 2013  7     84</span></span><br><span class="line"><span class="comment"># 2014  10    31</span></span><br></pre></td></tr></table></figure>

<h2 id="Pandas数据类型"><a href="#Pandas数据类型" class="headerlink" title="Pandas数据类型"></a>Pandas数据类型</h2><table>
<thead>
<tr>
<th>Pandas数据类型</th>
<th>说明</th>
<th>对应的Python类型</th>
</tr>
</thead>
<tbody><tr>
<td>Object</td>
<td>字符串类型</td>
<td>string</td>
</tr>
<tr>
<td>int</td>
<td>整数类型</td>
<td>int</td>
</tr>
<tr>
<td>float</td>
<td>浮点数类型</td>
<td>float</td>
</tr>
<tr>
<td>datetime</td>
<td>日期时间类型</td>
<td>datetime包中的datetime类型</td>
</tr>
<tr>
<td>timedelta</td>
<td>时间差类型</td>
<td>datetime包中的timedelta类型</td>
</tr>
<tr>
<td>category</td>
<td>分类类型</td>
<td>无原生类型，可以自定义</td>
</tr>
<tr>
<td>bool</td>
<td>布尔类型</td>
<td>bool（True,False）</td>
</tr>
<tr>
<td>nan</td>
<td>空值类型</td>
<td>None</td>
</tr>
</tbody></table>
<ul>
<li>可以通过下列API查看s对象或df对象中数据的类型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1.dtypes</span><br><span class="line">df1.dtypes</span><br><span class="line">df1.info() <span class="comment"># s对象没有info()方法</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>几个特殊类型演示</p>
<ul>
<li>datetime类型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个datetime类型的Series</span></span><br><span class="line">dates = pd.to_datetime([<span class="string">&#x27;2024-09-01&#x27;</span>, <span class="string">&#x27;2024-09-02&#x27;</span>, <span class="string">&#x27;2024-09-03&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(dates)</span><br></pre></td></tr></table></figure>

<ul>
<li>timedelta类型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算两个日期之间的差值</span></span><br><span class="line">start_date = pd.to_datetime(<span class="string">&#x27;2024-09-01&#x27;</span>)</span><br><span class="line">end_date = pd.to_datetime(<span class="string">&#x27;2024-09-05&#x27;</span>)</span><br><span class="line">delta = end_date - start_date</span><br><span class="line"><span class="built_in">print</span>(delta)</span><br></pre></td></tr></table></figure>

<ul>
<li>category类型</li>
</ul>
<p>类型用于表示分类数据，通常用于有限集合中的数据类型，例如性别、颜色、产品类型等。这种类型的优点在于占用更少的内存，并且对分类数据的操作更快。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个category类型的Series</span></span><br><span class="line">categories = pd.Series([<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>], dtype=<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(categories)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="⭐️⭐️⭐️Pandas基本数据操作"><a href="#⭐️⭐️⭐️Pandas基本数据操作" class="headerlink" title="⭐️⭐️⭐️Pandas基本数据操作"></a>⭐️⭐️⭐️Pandas基本数据操作</h2><h3 id="读取、写入数据"><a href="#读取、写入数据" class="headerlink" title="读取、写入数据"></a>读取、写入数据</h3><blockquote>
<p>获取数据方式有很多，包括去取CSV、MySQL、JSON、HDF5等等一些数据</p>
</blockquote>
<p>MySQL建立连接需要install包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql==<span class="number">1.0</span><span class="number">.2</span> -i https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line"><span class="comment"># 如果后边的代码运行提示找不到sqlalchemy的包，和pymysql一样进行安装即可</span></span><br><span class="line">pip install sqlalchemy==<span class="number">2.0</span><span class="number">.0</span> -i https://pypi.tuna.tsinghua.edu.cn/simple/</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># CSV文件写入</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, </span><br><span class="line">                 sep=<span class="string">&#x27;,&#x27;</span>,           <span class="comment"># 分隔符，默认为&#x27;,&#x27;</span></span><br><span class="line">                 header=<span class="number">0</span>,         <span class="comment"># 指定行号作为列名(默认为0)</span></span><br><span class="line">                 index_col=<span class="number">0</span>,      <span class="comment"># 指定列作为索引</span></span><br><span class="line">                 encoding=<span class="string">&#x27;utf-8&#x27;</span>, <span class="comment"># 编码方式</span></span><br><span class="line">                 dtype=&#123;<span class="string">&#x27;column1&#x27;</span>: <span class="built_in">str</span>&#125;, <span class="comment"># 指定列数据类型</span></span><br><span class="line">                 parse_dates=[<span class="string">&#x27;date_column&#x27;</span>], <span class="comment"># 解析日期列</span></span><br><span class="line">                 na_values=[<span class="string">&#x27;NA&#x27;</span>, <span class="string">&#x27;NULL&#x27;</span>]) <span class="comment"># 指定缺失值标识</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CSV文件写入</span></span><br><span class="line">data[:<span class="number">10</span>].to_csv(<span class="string">&quot;./data/test.csv&quot;</span>, columns=[<span class="string">&#x27;open&#x27;</span>])<span class="comment"># 选取10行数据保存,便于观察数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取，查看结果</span></span><br><span class="line">pd.read_csv(<span class="string">&quot;./data/test.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取Excel</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data.xlsx&#x27;</span>, </span><br><span class="line">                   sheet_name=<span class="string">&#x27;Sheet1&#x27;</span>, <span class="comment"># 指定工作表</span></span><br><span class="line">                   engine=<span class="string">&#x27;openpyxl&#x27;</span>)   <span class="comment"># 指定引擎</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入Excel</span></span><br><span class="line">df.to_excel(<span class="string">&#x27;output.xlsx&#x27;</span>, </span><br><span class="line">            sheet_name=<span class="string">&#x27;Sheet1&#x27;</span>,</span><br><span class="line">            index=<span class="literal">False</span>) <span class="comment"># 不写入索引列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取JSON</span></span><br><span class="line">df = pd.read_json(<span class="string">&#x27;data.json&#x27;</span>, </span><br><span class="line">                  orient=<span class="string">&#x27;records&#x27;</span>, <span class="comment"># JSON格式方向</span></span><br><span class="line">                  lines=<span class="literal">True</span>)      <span class="comment"># 每行一个JSON对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入JSON</span></span><br><span class="line">df.to_json(<span class="string">&#x27;output.json&#x27;</span>, </span><br><span class="line">           orient=<span class="string">&#x27;records&#x27;</span>,</span><br><span class="line">           indent=<span class="number">4</span>) <span class="comment"># 美化输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里是Pandas与MySQL建立链接需要导入的包</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建连接引擎</span></span><br><span class="line">engine = create_engine(<span class="string">&#x27;mysql+pymysql://user:password@host:port/database&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取SQL数据</span></span><br><span class="line">query = <span class="string">&quot;SELECT * FROM table_name WHERE condition&quot;</span></span><br><span class="line">df = pd.read_sql(query, engine)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入SQL</span></span><br><span class="line">df.to_sql(<span class="string">&#x27;table_name&#x27;</span>, </span><br><span class="line">          engine, </span><br><span class="line">          if_exists=<span class="string">&#x27;append&#x27;</span>, <span class="comment"># 如果表存在则追加</span></span><br><span class="line">          index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取HDF5</span></span><br><span class="line">df = pd.read_hdf(<span class="string">&#x27;data.h5&#x27;</span>, </span><br><span class="line">                 key=<span class="string">&#x27;dataset_name&#x27;</span>) <span class="comment"># 指定数据集键名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入HDF5</span></span><br><span class="line">df.to_hdf(<span class="string">&#x27;output.h5&#x27;</span>, </span><br><span class="line">          key=<span class="string">&#x27;dataset_name&#x27;</span>,</span><br><span class="line">          mode=<span class="string">&#x27;w&#x27;</span>) <span class="comment"># 写入模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取Parquet</span></span><br><span class="line">df = pd.read_parquet(<span class="string">&#x27;data.parquet&#x27;</span>,</span><br><span class="line">                     engine=<span class="string">&#x27;pyarrow&#x27;</span>) <span class="comment"># 指定引擎</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入Parquet</span></span><br><span class="line">df.to_parquet(<span class="string">&#x27;output.parquet&#x27;</span>,</span><br><span class="line">              compression=<span class="string">&#x27;snappy&#x27;</span>) <span class="comment"># 压缩方式</span></span><br></pre></td></tr></table></figure>

<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250701201538884.png" alt="image-20250701201538884"></p>
<h3 id="⭐️⭐️⭐️索引操作"><a href="#⭐️⭐️⭐️索引操作" class="headerlink" title="⭐️⭐️⭐️索引操作"></a>⭐️⭐️⭐️索引操作</h3><ul>
<li>直接索引方式（先列后行）：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接使用行列索引名字的方式（先列后行）</span></span><br><span class="line">data[<span class="string">&#x27;open&#x27;</span>][<span class="string">&#x27;2018-02-27&#x27;</span>]</span><br><span class="line"><span class="number">23.53</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不支持的操作</span></span><br><span class="line"><span class="comment"># 错误</span></span><br><span class="line">data[<span class="string">&#x27;2018-02-27&#x27;</span>][<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"><span class="comment"># 错误</span></span><br><span class="line">data[:<span class="number">1</span>, :<span class="number">2</span>]</span><br></pre></td></tr></table></figure>



<ul>
<li>结合loc或者iloc使用索引<ul>
<li>loc后面是行列索引名称</li>
<li>而iloc后面写index，正如名称带了i（index）</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用loc:只能指定行列索引的名字</span></span><br><span class="line">data.loc[<span class="string">&#x27;2018-02-27&#x27;</span>:<span class="string">&#x27;2018-02-22&#x27;</span>, <span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">27</span>    <span class="number">23.53</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">26</span>    <span class="number">22.80</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">23</span>    <span class="number">22.88</span></span><br><span class="line">Name: <span class="built_in">open</span>, dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用iloc可以通过索引的下标去获取</span></span><br><span class="line"><span class="comment"># 获取前3天数据,前5列的结果</span></span><br><span class="line">data.iloc[:<span class="number">3</span>, :<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">            <span class="built_in">open</span>    high    close    low</span><br><span class="line"><span class="number">2018</span>-02-<span class="number">27</span>    <span class="number">23.53</span>    <span class="number">25.88</span>    <span class="number">24.16</span>    <span class="number">23.53</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">26</span>    <span class="number">22.80</span>    <span class="number">23.78</span>    <span class="number">23.53</span>    <span class="number">22.80</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">23</span>    <span class="number">22.88</span>    <span class="number">23.37</span>    <span class="number">22.82</span>    <span class="number">22.71</span></span><br></pre></td></tr></table></figure>



<h3 id="⭐️⭐️赋值操作"><a href="#⭐️⭐️赋值操作" class="headerlink" title="⭐️⭐️赋值操作"></a>⭐️⭐️赋值操作</h3><ul>
<li>会将close（收盘价）全部的值设置为1</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接修改原来的值</span></span><br><span class="line">data[<span class="string">&#x27;close&#x27;</span>] = <span class="number">1</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">data.close = <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h3 id="⭐️⭐️排序操作"><a href="#⭐️⭐️排序操作" class="headerlink" title="⭐️⭐️排序操作"></a>⭐️⭐️排序操作</h3><blockquote>
<ul>
<li>dataframe<ul>
<li>对象.sort_values()</li>
<li>对象.sort_index()</li>
</ul>
</li>
<li>series<ul>
<li>对象.sort_values()</li>
<li>对象.sort_index()</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>DataFrame排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照开盘价大小进行排序 , 使用ascending指定按照大小排序</span></span><br><span class="line">data.sort_values(by=<span class="string">&quot;open&quot;</span>, ascending=<span class="literal">True</span>).head()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照多个键进行排序</span></span><br><span class="line">data.sort_values(by=[<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;high&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对索引进行排序</span></span><br><span class="line">data.sort_index()</span><br></pre></td></tr></table></figure>



<ul>
<li>Series排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;p_change&#x27;</span>].sort_values(ascending=<span class="literal">True</span>).head()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对索引进行排序</span></span><br><span class="line">data[<span class="string">&#x27;p_change&#x27;</span>].sort_index().head()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="⭐️⭐️DataFrame运算"><a href="#⭐️⭐️DataFrame运算" class="headerlink" title="⭐️⭐️DataFrame运算"></a>⭐️⭐️DataFrame运算</h2><h3 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h3><ul>
<li>add(other)</li>
</ul>
<p>比如进行数学运算加上具体的一个数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;open&#x27;</span>].add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">27</span>    <span class="number">24.53</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">26</span>    <span class="number">23.80</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">23</span>    <span class="number">23.88</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">22</span>    <span class="number">23.25</span></span><br><span class="line"><span class="number">2018</span>-02-<span class="number">14</span>    <span class="number">22.49</span></span><br></pre></td></tr></table></figure>

<ul>
<li>sub(other)</li>
</ul>
<p>比如进行数学运算减去具体的一个数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;open&#x27;</span>].sub(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<h3 id="⭐️⭐️逻辑运算"><a href="#⭐️⭐️逻辑运算" class="headerlink" title="⭐️⭐️逻辑运算"></a>⭐️⭐️逻辑运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[(data[<span class="string">&quot;open&quot;</span>] &gt; <span class="number">23</span>) &amp; (data[<span class="string">&quot;open&quot;</span>] &lt; <span class="number">24</span>)].head()</span><br></pre></td></tr></table></figure>

<ul>
<li>query(expr)<ul>
<li>expr:查询字符串</li>
</ul>
</li>
</ul>
<p>通过query使得刚才的过程更加方便简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.query(<span class="string">&quot;open&lt;24 &amp; open&gt;23&quot;</span>).head()</span><br></pre></td></tr></table></figure>

<ul>
<li>isin(values)</li>
</ul>
<p>例如判断’open’是否为23.53和23.85</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以指定值进行一个判断，从而进行筛选操作</span></span><br><span class="line">data[data[<span class="string">&quot;open&quot;</span>].isin([<span class="number">23.53</span>, <span class="number">23.85</span>])]</span><br></pre></td></tr></table></figure>



<h3 id="统计运算"><a href="#统计运算" class="headerlink" title="统计运算"></a>统计运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算平均值、标准差、最大值、最小值</span></span><br><span class="line">data.describe()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用统计函数：0 代表列    求结果， 1 代表行求统计结果</span></span><br><span class="line">data.<span class="built_in">max</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方差</span></span><br><span class="line">data.var(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准差</span></span><br><span class="line">data.std(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中位数</span></span><br><span class="line">df.median()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求出最大值的位置</span></span><br><span class="line">data.idxmax(axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求出最小值的位置</span></span><br><span class="line">data.idxmin(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>



<h3 id="累计统计"><a href="#累计统计" class="headerlink" title="累计统计"></a>累计统计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###   累计统计  ###</span></span><br><span class="line"><span class="comment"># 排序之后，进行累计求和</span></span><br><span class="line">data = data.sort_index()</span><br><span class="line"></span><br><span class="line">stock_rise = data[<span class="string">&#x27;p_change&#x27;</span>]</span><br><span class="line">stock_rise.cumsum()</span><br><span class="line"></span><br><span class="line"><span class="number">2015</span>-03-02      <span class="number">2.62</span></span><br><span class="line"><span class="number">2015</span>-03-03      <span class="number">4.06</span></span><br><span class="line"><span class="number">2015</span>-03-04      <span class="number">5.63</span></span><br><span class="line"><span class="number">2015</span>-03-05      <span class="number">7.65</span></span><br><span class="line"><span class="number">2015</span>-03-06     <span class="number">16.16</span></span><br><span class="line"><span class="number">2015</span>-03-09     <span class="number">16.37</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">10</span>     <span class="number">18.75</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">11</span>     <span class="number">16.36</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">12</span>     <span class="number">15.03</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">13</span>     <span class="number">17.58</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">16</span>     <span class="number">20.34</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">17</span>     <span class="number">22.42</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">18</span>     <span class="number">23.28</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">19</span>     <span class="number">23.74</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">20</span>     <span class="number">23.48</span></span><br><span class="line"><span class="number">2015</span>-03-<span class="number">23</span>     <span class="number">23.74</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># plot显示图形</span></span><br><span class="line">stock_rise.cumsum().plot()</span><br><span class="line"><span class="comment"># 需要调用show，才能显示出结果（大概就是一个折线图）</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<h3 id="apply自定义函数"><a href="#apply自定义函数" class="headerlink" title="apply自定义函数"></a>apply自定义函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个对列，最大值-最小值的函数</span></span><br><span class="line">data[[<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;close&#x27;</span>]].apply(<span class="keyword">lambda</span> x: x.<span class="built_in">max</span>() - x.<span class="built_in">min</span>(), axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>     <span class="number">22.74</span></span><br><span class="line">close    <span class="number">22.85</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>



<h2 id="⭐️⭐️⭐️DataFrame数据的增删改查操作"><a href="#⭐️⭐️⭐️DataFrame数据的增删改查操作" class="headerlink" title="⭐️⭐️⭐️DataFrame数据的增删改查操作"></a>⭐️⭐️⭐️DataFrame数据的增删改查操作</h2><h3 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一列数据都是固定值</span></span><br><span class="line">df3[<span class="string">&#x27;new col 1&#x27;</span>] = <span class="number">33</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增列数据数量必须和行数相等</span></span><br><span class="line">df3[<span class="string">&#x27;new col 2&#x27;</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">df3[<span class="string">&#x27;new col 3&#x27;</span>] = df3.year * <span class="number">2</span></span><br></pre></td></tr></table></figure>



<ul>
<li>使用assign函数增加</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过assign增加一列</span></span><br><span class="line">df3.assign(c1=<span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过assign增加多列</span></span><br><span class="line">df3.assign(</span><br><span class="line">    c2 = [<span class="string">&#x27;x1&#x27;</span>,<span class="string">&#x27;x2&#x27;</span>, <span class="string">&#x27;x3&#x27;</span>, <span class="string">&#x27;x4&#x27;</span>,<span class="string">&#x27;x5&#x27;</span>],</span><br><span class="line">    c3=df3.year * <span class="number">2</span>,</span><br><span class="line">    c4=<span class="keyword">lambda</span> df:df.year * <span class="number">100</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="删除与去重"><a href="#删除与去重" class="headerlink" title="删除与去重"></a>删除与去重</h3><p>1- df.drop删除行数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df3.drop([<span class="number">0</span>]) <span class="comment"># 默认删除行</span></span><br><span class="line">df3.drop([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]) <span class="comment"># 可以删除多行</span></span><br><span class="line">df3.GDP.drop([<span class="number">0</span>, <span class="number">2</span>]) <span class="comment"># 对series对象按索引删除</span></span><br></pre></td></tr></table></figure>



<p>2- df.drop删除列数据1</p>
<ul>
<li>df.drop默认删除指定索引值的行；如果添加参数<code>axis=1</code>，则删除指定列名的列</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df3.drop([<span class="string">&#x27;new col 3&#x27;</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<p>3- 使用del删除指定的列</p>
<ul>
<li>注意区别：<ul>
<li>del是直接永久删除原df中的列【慎重使用】</li>
<li>drop是返回删除后的df或seires，原df或seires没有被修改</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> df3[<span class="string">&#x27;new col 3&#x27;</span>]</span><br><span class="line">df3</span><br><span class="line"><span class="comment"># 重复运行本段代码将会报错，因为df3中的指定列在第一次运行时就被删除了</span></span><br></pre></td></tr></table></figure>



<p>4- Dataframe数据去重</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加一部分重复的数据</span></span><br><span class="line">df4 = df2.append(df2).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实施去重操作</span></span><br><span class="line">df4.drop_duplicates()</span><br></pre></td></tr></table></figure>



<p>5- series去重</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方式一:</span><br><span class="line">df4.country.drop_duplicates()</span><br><span class="line"><span class="comment"># 返回结果如下</span></span><br><span class="line"><span class="number">0</span>    美国</span><br><span class="line"><span class="number">1</span>    英国</span><br><span class="line"><span class="number">2</span>    法国</span><br><span class="line"><span class="number">3</span>    中国</span><br><span class="line"><span class="number">4</span>    日本</span><br><span class="line">Name: country, dtype: <span class="built_in">object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二:</span><br><span class="line">df4.country.unique()</span><br><span class="line"><span class="comment"># 返回结果如下</span></span><br><span class="line">array([<span class="string">&#x27;美国&#x27;</span>, <span class="string">&#x27;英国&#x27;</span>, <span class="string">&#x27;法国&#x27;</span>, <span class="string">&#x27;中国&#x27;</span>, <span class="string">&#x27;日本&#x27;</span>], dtype=<span class="built_in">object</span>)</span><br></pre></td></tr></table></figure>



<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df5 = df5.assign(GDP=<span class="number">66</span>) <span class="comment"># 可以接收单变量或列表、数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># series对象替换数据，返回的还是series对象，不会对原来的df造成修改</span></span><br><span class="line">df6.year.replace(<span class="number">1960</span>, <span class="number">19600</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果加上inplace=True参数，则会修改原始df</span></span><br><span class="line">df6.country.replace(<span class="string">&#x27;日本&#x27;</span>, <span class="string">&#x27;扶桑&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># df也可以直接调用replace函数，用法和s.replace用法一致，只是返回的是df对象</span></span><br><span class="line">df6.replace(<span class="number">1960</span>, <span class="number">19600</span>)</span><br></pre></td></tr></table></figure>



<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><ul>
<li>1- 从前从后取多行数据</li>
</ul>
<p>head()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导包 </span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 加载csv数据，指定gbk编码格式来读取文件，返回df</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;../数据集/1960-2019全球GDP数据.csv&#x27;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认取前5行数据</span></span><br><span class="line">df.head()</span><br><span class="line">df.head(<span class="number">10</span>) <span class="comment"># 取前10行</span></span><br></pre></td></tr></table></figure>



<p>tail()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认取后5行数据</span></span><br><span class="line">df.tail()</span><br><span class="line">df2 = df.tail(<span class="number">15</span>) <span class="comment"># 倒数15行</span></span><br></pre></td></tr></table></figure>



<p>2- 获取一列或多列数据</p>
<ul>
<li>获取一列数据<code>df[col_name]</code>等同于<code>df.col_name</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df2[<span class="string">&#x27;country&#x27;</span>]</span><br><span class="line">df2.country</span><br><span class="line"><span class="comment"># 注意！如果列名字符串中间有空格的，只能使用df[&#x27;country&#x27;]这种形式</span></span><br></pre></td></tr></table></figure>



<p>获取多列数据<code>df[[col_name1,col_name2,...]]</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df2[[<span class="string">&#x27;country&#x27;</span>, <span class="string">&#x27;GDP&#x27;</span>]] <span class="comment"># 返回新的df</span></span><br></pre></td></tr></table></figure>



<p>3- 索引下标切片取行</p>
<ul>
<li><code>df[start:stop:step]</code>:</li>
</ul>
<blockquote>
<p><code>df[start:stop:step]</code> &#x3D;&#x3D; <code>df[起始行下标:结束行下标:步长]</code> ， 遵循<code>顾头不顾尾</code>原则（包含起始行，不包含结束行），<code>步长</code>默认为1</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df4 = df.head(<span class="number">10</span>) <span class="comment"># 取原df前10行数据作为df4，默认自增索引由0到9</span></span><br><span class="line">df4[<span class="number">0</span>:<span class="number">3</span>] <span class="comment"># 取前3行</span></span><br><span class="line">df4[:<span class="number">5</span>:<span class="number">2</span>] <span class="comment"># 取前5行，步长为2</span></span><br><span class="line">df4[<span class="number">1</span>::<span class="number">3</span>] <span class="comment"># 取第2行到最后所有行，步长为3</span></span><br></pre></td></tr></table></figure>



<p>4- 查询函数获取子集: df.query()</p>
<blockquote>
<ul>
<li><code>df.query(判断表达式)</code>可以依据判断表达式返回的符合条件的df子集</li>
<li>与<code>df[布尔值向量]</code>效果相同</li>
<li>特别注意<code>df.query()</code>中传入的字符串格式</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df3.query(<span class="string">&#x27;country==&quot;帕劳&quot;&#x27;</span>)</span><br><span class="line">df3[df3[<span class="string">&#x27;country&#x27;</span>]==<span class="string">&#x27;帕劳&#x27;</span>]</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询中国, 美国 日本 三国 2015年至2019年的数据</span></span><br><span class="line">df.query(<span class="string">&#x27;country==&quot;中国&quot; or country==&quot;日本&quot; or country==&quot;美国&quot;&#x27;</span>).query(<span class="string">&#x27;year in [&quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2019&quot;]&#x27;</span>)</span><br><span class="line">df.query(<span class="string">&#x27;(country==&quot;中国&quot; or country==&quot;日本&quot; or country==&quot;美国&quot;) and year in [&quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2019&quot;]&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>5- 排序函数</p>
<ul>
<li>sort_values函数: 按照指定的一列或多列的值进行排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按GDP列的数值由小到大进行排序</span></span><br><span class="line">df2.sort_values([<span class="string">&#x27;GDP&#x27;</span>])</span><br><span class="line"><span class="comment"># 按GDP列的数值由大到小进行排序</span></span><br><span class="line">df2.sort_values([<span class="string">&#x27;GDP&#x27;</span>], ascending=<span class="literal">False</span>) <span class="comment"># 倒序， ascending默认为True</span></span><br><span class="line"><span class="comment"># 先对year年份进行由小到大排序，再对GDP由小到大排序</span></span><br><span class="line">df2.sort_values([<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;GDP&#x27;</span>])</span><br></pre></td></tr></table></figure>



<p>rank函数:</p>
<blockquote>
<ul>
<li>rank函数用法：<code>DataFrame.rank()</code> 或 <code>Series.rank()</code></li>
<li>rank函数返回值：以Series或者DataFrame的类型返回数据的排名（哪个类型调用返回哪个类型）</li>
<li>rank函数包含有6个参数：</li>
<li><strong>axis</strong>：设置沿着哪个轴计算排名（0或者1)，默认为0按纵轴计算排名</li>
<li><strong>numeric_only</strong>：是否仅仅计算数字型的columns，默认为False</li>
<li>na_option ：NaN值是否参与排序及如何排序，固定参数：keep  top  bottom</li>
<li>keep: NaN值保留原有位置</li>
<li>top: NaN值全部放在前边</li>
<li>bottom: NaN值全部放在最后</li>
<li><strong>ascending</strong>：设定升序排还是降序排，默认True升序</li>
<li><strong>pct</strong>：是否以排名的百分比显示排名（所有排名与最大排名的百分比），默认False</li>
<li>method：排名评分的计算方式，固定值参数，常用固定值如下：</li>
<li>average : 默认值，排名评分不连续；数值相同的评分一致，都为平均值</li>
<li>min : 排名评分不连续；数值相同的评分一致，都为最小值</li>
<li>max : 排名评分不连续；数值相同的评分一致，都为最大值</li>
<li>dense : 排名评分是连续的；数值相同的评分一致</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">df7 = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;姓名&#x27;</span>:[<span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;小美&#x27;</span>, <span class="string">&#x27;小强&#x27;</span>, <span class="string">&#x27;小兰&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;成绩&#x27;</span>:[<span class="number">100</span>, <span class="number">90</span>, <span class="number">90</span>, <span class="number">80</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">df7.rank()  <span class="comment"># 等价于df7.rank(method=&#x27;average&#x27;, ascending=True)</span></span><br><span class="line">    姓名    成绩</span><br><span class="line"><span class="number">0</span>  <span class="number">4.0</span>  <span class="number">4.0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">2.5</span>  <span class="number">2.5</span></span><br><span class="line"><span class="number">2</span>  <span class="number">2.5</span>  <span class="number">2.5</span></span><br><span class="line"><span class="number">3</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">df7[<span class="string">&#x27;成绩排名&#x27;</span>] = df7.成绩.rank(method=<span class="string">&#x27;min&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">   姓名   成绩  成绩排名</span><br><span class="line"><span class="number">0</span>  小明  <span class="number">100</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  小美   <span class="number">90</span>   <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>  小强   <span class="number">90</span>   <span class="number">2.0</span></span><br><span class="line"><span class="number">3</span>  小兰   <span class="number">80</span>   <span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">df7[<span class="string">&#x27;成绩排名&#x27;</span>] = df7.成绩.rank(method=<span class="string">&#x27;max&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">   姓名   成绩  成绩排名</span><br><span class="line"><span class="number">0</span>  小明  <span class="number">100</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  小美   <span class="number">90</span>   <span class="number">3.0</span></span><br><span class="line"><span class="number">2</span>  小强   <span class="number">90</span>   <span class="number">3.0</span></span><br><span class="line"><span class="number">3</span>  小兰   <span class="number">80</span>   <span class="number">4.0</span></span><br><span class="line"></span><br><span class="line">df7[<span class="string">&#x27;成绩排名&#x27;</span>] = df7.成绩.rank(method=<span class="string">&#x27;dense&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">   姓名   成绩  成绩排名</span><br><span class="line"><span class="number">0</span>  小明  <span class="number">100</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">1</span>  小美   <span class="number">90</span>   <span class="number">2.0</span></span><br><span class="line"><span class="number">2</span>  小强   <span class="number">90</span>   <span class="number">2.0</span></span><br><span class="line"><span class="number">3</span>  小兰   <span class="number">80</span>   <span class="number">3.0</span></span><br></pre></td></tr></table></figure>



<h2 id="⭐️⭐️⭐️缺失值处理"><a href="#⭐️⭐️⭐️缺失值处理" class="headerlink" title="⭐️⭐️⭐️缺失值处理"></a>⭐️⭐️⭐️缺失值处理</h2><h3 id="缺失值为NAN"><a href="#缺失值为NAN" class="headerlink" title="缺失值为NAN"></a>缺失值为NAN</h3><p>删除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不修改原数据</span></span><br><span class="line">movie.dropna()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以定义新的变量接受或者用原来的变量名</span></span><br><span class="line">data = movie.dropna()</span><br></pre></td></tr></table></figure>



<p>替换&#x2F;填充</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 替换存在缺失值的样本的两列</span></span><br><span class="line"><span class="comment"># 替换填充平均值，中位数</span></span><br><span class="line"> movie[<span class="string">&#x27;Revenue (Millions)&#x27;</span>].fillna(movie[<span class="string">&#x27;Revenue (Millions)&#x27;</span>].mean(), inplace=<span class="literal">True</span>)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 替换所有</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> movie.columns:</span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">all</span>(pd.notnull(movie[i])) == <span class="literal">False</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        movie[i].fillna(movie[i].mean(), inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h3 id="缺失值是特殊字符"><a href="#缺失值是特殊字符" class="headerlink" title="缺失值是特殊字符"></a>缺失值是特殊字符</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wis = pd.read_csv(<span class="string">&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把一些其它值标记的缺失值，替换成np.nan</span></span><br><span class="line">wis = wis.replace(to_replace=<span class="string">&#x27;?&#x27;</span>, value=np.nan)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">wis = wis.dropna()</span><br></pre></td></tr></table></figure>



<p>以上数据在读取时，可能会报如下错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URLError: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:<span class="number">833</span>)&gt;</span><br></pre></td></tr></table></figure>



<p>解决办法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局取消证书验证</span></span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br></pre></td></tr></table></figure>



<h2 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h2><blockquote>
<ul>
<li>pd.concat实现数据的合并 &#x3D;&gt; union</li>
<li>pd.merge实现数据的合并 &#x3D;&gt; join</li>
</ul>
</blockquote>
<h3 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h3><p>pd.concat([data1, data2], axis&#x3D;1)</p>
<ul>
<li>按照行或列进行合并,axis&#x3D;0为列索引，axis&#x3D;1为行索引</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建两个DataFrame</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;A1&#x27;</span>, <span class="string">&#x27;A2&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;B1&#x27;</span>, <span class="string">&#x27;B2&#x27;</span>]&#125;,</span><br><span class="line">                   index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;A3&#x27;</span>, <span class="string">&#x27;A4&#x27;</span>, <span class="string">&#x27;A5&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;B3&#x27;</span>, <span class="string">&#x27;B4&#x27;</span>, <span class="string">&#x27;B5&#x27;</span>]&#125;,</span><br><span class="line">                   index=[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 垂直连接（默认axis=0）</span></span><br><span class="line">result = pd.concat([df1, df2])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">    A   B</span><br><span class="line"><span class="number">0</span>  A0  B0</span><br><span class="line"><span class="number">1</span>  A1  B1</span><br><span class="line"><span class="number">2</span>  A2  B2</span><br><span class="line"><span class="number">3</span>  A3  B3</span><br><span class="line"><span class="number">4</span>  A4  B4</span><br><span class="line"><span class="number">5</span>  A5  B5</span><br><span class="line"></span><br><span class="line">df3 = pd.DataFrame(&#123;<span class="string">&#x27;C&#x27;</span>: [<span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;C1&#x27;</span>, <span class="string">&#x27;C2&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;D&#x27;</span>: [<span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;D1&#x27;</span>, <span class="string">&#x27;D2&#x27;</span>]&#125;,</span><br><span class="line">                   index=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 水平连接</span></span><br><span class="line">result = pd.concat([df1, df3], axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">    A   B   C   D</span><br><span class="line"><span class="number">0</span>  A0  B0  C0  D0</span><br><span class="line"><span class="number">1</span>  A1  B1  C1  D1</span><br><span class="line"><span class="number">2</span>  A2  B2  C2  D2</span><br><span class="line"></span><br><span class="line">df4 = pd.DataFrame(&#123;<span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;B2&#x27;</span>, <span class="string">&#x27;B3&#x27;</span>, <span class="string">&#x27;B4&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;D&#x27;</span>: [<span class="string">&#x27;D2&#x27;</span>, <span class="string">&#x27;D3&#x27;</span>, <span class="string">&#x27;D4&#x27;</span>]&#125;,</span><br><span class="line">                   index=[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接不同索引的DataFrame</span></span><br><span class="line">result = pd.concat([df1, df4], axis=<span class="number">0</span>, sort=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">     A   B    D</span><br><span class="line"><span class="number">0</span>   A0  B0  NaN</span><br><span class="line"><span class="number">1</span>   A1  B1  NaN</span><br><span class="line"><span class="number">2</span>   A2  B2  NaN</span><br><span class="line"><span class="number">2</span>  NaN  B2   D2</span><br><span class="line"><span class="number">3</span>  NaN  B3   D3</span><br><span class="line"><span class="number">4</span>  NaN  B4   D4</span><br></pre></td></tr></table></figure>



<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><blockquote>
<p>pd.merge(left, right, how&#x3D;’inner’, on&#x3D;None)</p>
<ul>
<li>可以指定按照两组数据的共同键值对合并或者左右各自</li>
<li><code>left</code>: DataFrame</li>
<li><code>right</code>: 另一个DataFrame</li>
<li><code>on</code>: 指定的共同键</li>
<li>how:按照什么方式连接</li>
</ul>
</blockquote>
<p>看这里：<a href="https://liamjohnson-w.github.io/2024/08/12/2024.08.12/#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86-%E5%90%88%E5%B9%B6">https://liamjohnson-w.github.io/2024/08/12/2024.08.12/#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86-%E5%90%88%E5%B9%B6</a></p>
<h2 id="数据分组"><a href="#数据分组" class="headerlink" title="数据分组"></a>数据分组</h2><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导包 加载数据集</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;../数据集/uniqlo.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于顾客性别、不同城市分组</span></span><br><span class="line">gs2 = df.groupby([<span class="string">&#x27;gender_group&#x27;</span>, <span class="string">&#x27;city&#x27;</span>])</span><br><span class="line">gs2</span><br><span class="line"><span class="comment"># 返回结果如下</span></span><br><span class="line">&lt;pandas.core.groupby.generic.DataFrameGroupBy <span class="built_in">object</span> at <span class="number">0x000001B1DB24F1F0</span>&gt;</span><br><span class="line"></span><br><span class="line">gs2.first() <span class="comment"># 取出每组第一条数据</span></span><br><span class="line">gs2.last() <span class="comment"># 取出每组最后一条数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按分组依据获取其中一组</span></span><br><span class="line">gs2.get_group((<span class="string">&#x27;Female&#x27;</span>, <span class="string">&#x27;线上&#x27;</span>))</span><br></pre></td></tr></table></figure>



<h3 id="分组聚合"><a href="#分组聚合" class="headerlink" title="分组聚合"></a>分组聚合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按城市和线上线下划分，分别计算销售金额的平均值、成本的总和</span></span><br><span class="line">df.groupby([<span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;channel&#x27;</span>]).agg(&#123;</span><br><span class="line">    <span class="string">&#x27;revenue&#x27;</span>:<span class="string">&#x27;mean&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;unit_cost&#x27;</span>:<span class="string">&#x27;sum&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="分组过滤"><a href="#分组过滤" class="headerlink" title="分组过滤"></a>分组过滤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按城市分组，查询每组销售金额平均值大于200的全部数据</span></span><br><span class="line">df.groupby([<span class="string">&#x27;city&#x27;</span>]).<span class="built_in">filter</span>(<span class="keyword">lambda</span> s: s[<span class="string">&#x27;revenue&#x27;</span>].mean() &gt; <span class="number">200</span>)</span><br><span class="line">df.groupby([<span class="string">&#x27;city&#x27;</span>])[<span class="string">&#x27;revenue&#x27;</span>].<span class="built_in">filter</span>(<span class="keyword">lambda</span> s: s.mean() &gt; <span class="number">200</span>)</span><br></pre></td></tr></table></figure>



<h2 id="交叉表与透视表"><a href="#交叉表与透视表" class="headerlink" title="交叉表与透视表"></a>交叉表与透视表</h2><blockquote>
<ul>
<li><p>交叉表：</p>
<p>交叉表用于计算一列数据对于另外一列数据的分组个数(用于统计分组频率的特殊透视表)</p>
<ul>
<li>pd.crosstab(value1, value2)</li>
</ul>
</li>
<li><p>透视表：</p>
<p>透视表是将原有的DataFrame的列分别作为行索引和列索引，然后对指定的列应用聚集函数</p>
<ul>
<li>data.pivot_table(）</li>
<li>DataFrame.pivot_table([], index&#x3D;[])</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="交叉表"><a href="#交叉表" class="headerlink" title="交叉表"></a>交叉表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个示例数据集</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;性别&#x27;</span>: [<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;男&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;购买&#x27;</span>: [<span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;否&#x27;</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;否&#x27;</span>, <span class="string">&#x27;否&#x27;</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;否&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建交叉表</span></span><br><span class="line">crosstab = pd.crosstab(df[<span class="string">&#x27;性别&#x27;</span>], df[<span class="string">&#x27;购买&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(crosstab)</span><br><span class="line"></span><br><span class="line">购买  否  是</span><br><span class="line">性别        </span><br><span class="line">女    <span class="number">2</span>   <span class="number">2</span></span><br><span class="line">男    <span class="number">2</span>   <span class="number">2</span></span><br></pre></td></tr></table></figure>



<h3 id="透视表"><a href="#透视表" class="headerlink" title="透视表"></a>透视表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;性别&#x27;</span>: [<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;购买&#x27;</span>: [<span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;否&#x27;</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;否&#x27;</span>, <span class="string">&#x27;否&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;金额&#x27;</span>: [<span class="number">100</span>, <span class="number">150</span>, <span class="number">200</span>, <span class="number">130</span>, <span class="number">160</span>, <span class="number">120</span>]</span><br><span class="line">&#125;</span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建透视表</span></span><br><span class="line">pivot_table = pd.pivot_table(df, values=<span class="string">&#x27;金额&#x27;</span>, index=<span class="string">&#x27;性别&#x27;</span>, columns=<span class="string">&#x27;购买&#x27;</span>, aggfunc=<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(pivot_table)</span><br><span class="line"></span><br><span class="line">购买      否     是</span><br><span class="line">性别             </span><br><span class="line">女   <span class="number">135.0</span>  <span class="number">130.0</span></span><br><span class="line">男   <span class="number">180.0</span>  <span class="number">150.0</span></span><br></pre></td></tr></table></figure>



<h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><p>数据准备</p>
<ul>
<li>准备两列数据，星期数据以及涨跌幅是好是坏数据</li>
<li>进行交叉表计算</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 寻找星期几跟股票张得的关系</span></span><br><span class="line"><span class="comment"># 1、先把对应的日期找到星期几</span></span><br><span class="line">date = pd.to_datetime(data.index).weekday</span><br><span class="line">data[<span class="string">&#x27;week&#x27;</span>] = date</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、假如把p_change按照大小去分个类0为界限</span></span><br><span class="line">data[<span class="string">&#x27;posi_neg&#x27;</span>] = np.where(data[<span class="string">&#x27;p_change&#x27;</span>] &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过交叉表找寻两列数据的关系</span></span><br><span class="line">count = pd.crosstab(data[<span class="string">&#x27;week&#x27;</span>], data[<span class="string">&#x27;posi_neg&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>但是我们看到count只是每个星期日子的好坏天数，并没有得到比例，该怎么去做？</p>
<ul>
<li>对于每个星期一等的总天数求和，运用除法运算求出比例</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 算数运算，先求和</span></span><br><span class="line"><span class="built_in">sum</span> = count.<span class="built_in">sum</span>(axis=<span class="number">1</span>).astype(np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行相除操作，得出比例</span></span><br><span class="line">pro = count.div(<span class="built_in">sum</span>, axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>查看效果</p>
<p>使用plot画出这个比例，使用stacked的柱状图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pro.plot(kind=<span class="string">&#x27;bar&#x27;</span>, stacked=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>使用pivot_table(透视表)实现</p>
<p>使用透视表，刚才的过程更加简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过透视表，将整个过程变成更简单一些</span></span><br><span class="line">data.pivot_table([<span class="string">&#x27;posi_neg&#x27;</span>], index=<span class="string">&#x27;week&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="⭐️⭐️Pandas综合案例⭐️⭐️"><a href="#⭐️⭐️Pandas综合案例⭐️⭐️" class="headerlink" title="⭐️⭐️Pandas综合案例⭐️⭐️"></a>⭐️⭐️Pandas综合案例⭐️⭐️</h1><blockquote>
<p>两个案例对接实际业务场景，算是Pandas的入门经典案例了。</p>
</blockquote>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250702201844580.png" alt="image-20250702201844580"></p>
<h2 id="GDP案例"><a href="#GDP案例" class="headerlink" title="GDP案例"></a>GDP案例</h2><blockquote>
<p>源数据长这样</p>
</blockquote>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250702201718788.png" alt="image-20250702201718788"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">&quot;../Files/1960-2019全球GDP数据.csv&quot;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">df.info()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.筛选出 2000 年之后（含 2000 年）的数据，计算这些数据中各国家 GDP 的总和。</span></span><br><span class="line">df[df[<span class="string">&#x27;year&#x27;</span>] &gt;= <span class="number">2000</span>].groupby(<span class="string">&#x27;country&#x27;</span>).agg(&#123;<span class="string">&#x27;GDP&#x27;</span>:<span class="string">&#x27;sum&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.按国家分组，过滤出 GDP 数据标准差大于 1000000 的国家，显示这些国家的名称和 GDP 标准差。</span></span><br><span class="line">  <span class="comment"># 方法1：先分组计算标准差，再筛选</span></span><br><span class="line">std_df = df.groupby(<span class="string">&#x27;country&#x27;</span>)[<span class="string">&#x27;GDP&#x27;</span>].std().reset_index()</span><br><span class="line">result = std_df[std_df[<span class="string">&#x27;GDP&#x27;</span>] &gt; <span class="number">1000000</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 方法2：使用agg和filter的组合</span></span><br><span class="line">result = df.groupby(<span class="string">&#x27;country&#x27;</span>)[<span class="string">&#x27;GDP&#x27;</span>].agg([<span class="string">&#x27;std&#x27;</span>]).reset_index()</span><br><span class="line">result = result[result[<span class="string">&#x27;std&#x27;</span>] &gt; <span class="number">1000000</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.计算每个国家 GDP 占全球 GDP 总和的比例，按年份分组，找出每年占比最高的前三个国家。</span></span><br><span class="line">  <span class="comment"># 计算每个国家每年GDP占全球GDP的比例</span></span><br><span class="line">df[<span class="string">&#x27;gdp_ratio&#x27;</span>] = df.groupby(<span class="string">&#x27;year&#x27;</span>)[<span class="string">&#x27;GDP&#x27;</span>].apply(<span class="keyword">lambda</span> x: x / x.<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 按年份分组，找出每年GDP占比最高的前3个国家</span></span><br><span class="line">top3_countries = df.groupby(<span class="string">&#x27;year&#x27;</span>).apply(</span><br><span class="line">    <span class="keyword">lambda</span> x: x.nlargest(<span class="number">3</span>, <span class="string">&#x27;gdp_ratio&#x27;</span>)[[<span class="string">&#x27;country&#x27;</span>, <span class="string">&#x27;gdp_ratio&#x27;</span>]]</span><br><span class="line">).reset_index(drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.把国家名称中包含特定字符（如 “国”）的国家数据提取出来，按 GDP 降序排序，保存为新的 CSV 文件。</span></span><br><span class="line">  <span class="comment"># 提取国家名称中包含&quot;国&quot;的数据</span></span><br><span class="line">filtered_df = df[df[<span class="string">&#x27;country&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;国&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 按GDP降序排序</span></span><br><span class="line">sorted_df = filtered_df.sort_values(<span class="string">&#x27;GDP&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 保存为新的CSV文件</span></span><br><span class="line">sorted_df.to_csv(<span class="string">&#x27;countries_with_国.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="优衣库案例"><a href="#优衣库案例" class="headerlink" title="优衣库案例"></a>优衣库案例</h2><blockquote>
<p>算是很经典的案例了吧，网上有很多demo。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">&quot;../Files/uniqlo.csv&quot;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">df.info()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.读取文件，筛选出价格在 50 - 100 元之间且销量大于 100 的商品，按销量降序排序后保存为新的 CSV 文件。</span></span><br><span class="line">  <span class="comment"># 筛选条件</span></span><br><span class="line">filtered_df = df[(df[<span class="string">&#x27;价格&#x27;</span>] &gt;= <span class="number">50</span>) &amp; (df[<span class="string">&#x27;价格&#x27;</span>] &lt;= <span class="number">100</span>) &amp; (df[<span class="string">&#x27;销量&#x27;</span>] &gt; <span class="number">100</span>)]=</span><br><span class="line">  <span class="comment"># 按销量降序排序</span></span><br><span class="line">sorted_df = filtered_df.sort_values(<span class="string">&#x27;销量&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">  <span class="comment"># 保存为新CSV文件</span></span><br><span class="line">sorted_df.to_csv(<span class="string">&#x27;filtered_uniqlo.csv&#x27;</span>, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.按商品类别分组，过滤出平均价格低于 30 元的类别，展示这些类别的名称和平均价格。</span></span><br><span class="line">  <span class="comment"># 按类别分组计算平均价格</span></span><br><span class="line">category_avg = df.groupby(<span class="string">&#x27;商品类别&#x27;</span>)[<span class="string">&#x27;价格&#x27;</span>].mean().reset_index()</span><br><span class="line">  <span class="comment"># 筛选平均价格低于30元的类别</span></span><br><span class="line">low_price_categories = category_avg[category_avg[<span class="string">&#x27;价格&#x27;</span>] &lt; <span class="number">30</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.读取文件后，去除销量为 0 的商品记录，然后计算剩余商品的总销售额。</span></span><br><span class="line">  <span class="comment"># 去除销量为0的记录</span></span><br><span class="line">non_zero_sales = df[df[<span class="string">&#x27;销量&#x27;</span>] &gt; <span class="number">0</span>]</span><br><span class="line">  <span class="comment"># 计算销售额(价格×销量)</span></span><br><span class="line">non_zero_sales[<span class="string">&#x27;销售额&#x27;</span>] = non_zero_sales[<span class="string">&#x27;价格&#x27;</span>] * non_zero_sales[<span class="string">&#x27;销量&#x27;</span>]</span><br><span class="line">  <span class="comment"># 计算总销售额</span></span><br><span class="line">total_sales = non_zero_sales[<span class="string">&#x27;销售额&#x27;</span>].<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>

<h1 id="⭐️RFM案例⭐️"><a href="#⭐️RFM案例⭐️" class="headerlink" title="⭐️RFM案例⭐️"></a>⭐️RFM案例⭐️</h1><blockquote>
<p>RFM是什么？</p>
<ul>
<li><p>Recency：最近一次购买时间</p>
</li>
<li><p>Frequency：购买频率</p>
</li>
<li><p>Monetary：购买金额</p>
</li>
</ul>
</blockquote>
<h2 id="需求说明："><a href="#需求说明：" class="headerlink" title="需求说明："></a>需求说明：</h2><p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250704192745803.png" alt="image-20250704192745803"></p>
<p>原始数据长这样：</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20250704195013659.png" alt="image-20250704195013659"></p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><blockquote>
<ul>
<li>如果Excel有多个Sheet，则pd.read_excel会生成字典：{‘Sheet名称’: ‘Sheet对应的DataFrame’}</li>
<li>多个DataFrame进行Concat会上下拼接（类似Union all）但注意设置ignore_redex&#x3D;False</li>
<li>pd[‘提交日期’].dt.year会获取日期的年（类似还有：dt.month、dt.days)</li>
<li>重命名DataFrame中的Column：<ul>
<li>df.columns &#x3D; [‘year’, ‘会员ID’, ‘r’, ‘f’, ‘m’]</li>
</ul>
</li>
<li>pd.cut(column，bins列表，labels&#x3D;[3, 2, 1])会根据bins划分的区间对DataFrame中的column列进行打标，标签为labels中对应的数据，如：<ul>
<li>df[‘r_lable’] &#x3D; pd.cut(df[‘r’], bins&#x3D;r_bins, labels&#x3D;[3, 2, 1])</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">sheet_names = [<span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;会员等级&#x27;</span>]</span><br><span class="line"></span><br><span class="line">sheet_dict = pd.read_excel(<span class="string">&#x27;/Users/lifuyao/PycharmProjects/pythonProject/Files/sales1.xls&#x27;</span>, sheet_name=sheet_names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览数据信息</span></span><br><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> Bar3D</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据预处理</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sheet_names[:-<span class="number">1</span>]:</span><br><span class="line">    sheet_dict[i] = sheet_dict[i].dropna()</span><br><span class="line">    sheet_dict[i] = sheet_dict[i].query(<span class="string">&#x27;订单金额 &gt; 1&#x27;</span>)</span><br><span class="line">    sheet_dict[i] = sheet_dict[i].assign(max_year_date = sheet_dict[i][<span class="string">&#x27;提交日期&#x27;</span>].<span class="built_in">max</span>())</span><br><span class="line">    <span class="built_in">print</span>(sheet_dict[i].info())</span><br><span class="line">    </span><br><span class="line">pd_concat = pd.concat(<span class="built_in">list</span>(sheet_dict.values())[:-<span class="number">1</span>], ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">pd_concat[<span class="string">&#x27;year&#x27;</span>] = pd_concat[<span class="string">&#x27;提交日期&#x27;</span>].dt.year</span><br><span class="line"></span><br><span class="line">pd_concat[<span class="string">&#x27;time_delate&#x27;</span>] = (pd_concat[<span class="string">&#x27;max_year_date&#x27;</span>] - pd_concat[<span class="string">&#x27;提交日期&#x27;</span>]).dt.days</span><br><span class="line"></span><br><span class="line">df = pd_concat.groupby([<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;会员ID&#x27;</span>], as_index=<span class="literal">False</span>).agg(&#123;</span><br><span class="line">    <span class="string">&#x27;time_delate&#x27;</span>: <span class="string">&#x27;min&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;订单号&#x27;</span>: <span class="string">&#x27;count&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;订单金额&#x27;</span>: <span class="string">&#x27;sum&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">df.columns = [<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;会员ID&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;m&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分区间</span></span><br><span class="line"><span class="comment"># 系统自动划分区间</span></span><br><span class="line"><span class="comment"># pd.cut(df[&#x27;r&#x27;], bins=3).unique</span></span><br><span class="line"><span class="comment"># [(-0.365, 121.667] &lt; (121.667, 243.333] &lt; (243.333, 365.0]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定区间数，用describe函数获得的25%,50%,75%中位数划分</span></span><br><span class="line">df.describe()</span><br><span class="line"></span><br><span class="line">r_bins = [-<span class="number">1</span>, <span class="number">79</span>, <span class="number">255</span>,<span class="number">365</span>]</span><br><span class="line">f_bins = [<span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">130</span>]</span><br><span class="line">m_bins = [<span class="number">1</span>, <span class="number">69</span>, <span class="number">1199</span>, <span class="number">206300</span>]</span><br><span class="line"></span><br><span class="line">pd.cut(df[<span class="string">&#x27;r&#x27;</span>], bins=r_bins).unique()</span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;r_lable&#x27;</span>] = pd.cut(df[<span class="string">&#x27;r&#x27;</span>], bins=r_bins, labels=[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line">df[<span class="string">&#x27;f_lable&#x27;</span>] = pd.cut(df[<span class="string">&#x27;f&#x27;</span>], bins=f_bins, labels=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">df[<span class="string">&#x27;m_lable&#x27;</span>] = pd.cut(df[<span class="string">&#x27;m&#x27;</span>], bins=m_bins, labels=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接评分</span></span><br><span class="line">df[<span class="string">&#x27;r_lable&#x27;</span>] = df[<span class="string">&#x27;r_lable&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">df[<span class="string">&#x27;f_lable&#x27;</span>] = df[<span class="string">&#x27;f_lable&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line">df[<span class="string">&#x27;m_lable&#x27;</span>] = df[<span class="string">&#x27;m_lable&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;rfm_group&#x27;</span>] = df[<span class="string">&#x27;r_lable&#x27;</span>] + df[<span class="string">&#x27;f_lable&#x27;</span>] + df[<span class="string">&#x27;m_lable&#x27;</span>]</span><br><span class="line"></span><br><span class="line">df.head()</span><br><span class="line"><span class="comment"># 存储为Excel</span></span><br><span class="line">df.to_excel(<span class="string">&quot;./res.xlsx&quot;</span>, index = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="comment"># 存储到Mysql中（1，创建引擎 2，写入数据</span></span><br><span class="line">engine= create_engine(<span class="string">&#x27;mysql+pymysql://root:root@localhost:3306/rfm_db?charset=utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、具体导出数据到MySQL表中</span></span><br><span class="line">df.to_sql(<span class="string">&#x27;sales_rfm_score&#x27;</span>,engine,index=<span class="literal">False</span>,if_exists=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pyecharts 交付  rfm_group(分组结果评分), year(统计年份), number(评分个数)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7-3 pyecharts 交付</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> Bar3D         </span><br><span class="line"><span class="keyword">from</span> pyecharts.commons.utils <span class="keyword">import</span> JsCode</span><br><span class="line"><span class="keyword">import</span> pyecharts.options <span class="keyword">as</span> opts</span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="comment"># 5.1 准备可视化的数据, 即: rfm_group(分组结果评分), year(统计年份), number(评分个数)</span></span><br><span class="line">display_data = df.groupby([<span class="string">&#x27;rfm_group&#x27;</span>, <span class="string">&#x27;year&#x27;</span>], as_index=<span class="literal">False</span>).agg(&#123;<span class="string">&#x27;会员ID&#x27;</span>: <span class="string">&#x27;count&#x27;</span>&#125;)</span><br><span class="line">display_data</span><br><span class="line"><span class="comment"># 5.2 修改列名.</span></span><br><span class="line">display_data.columns = [<span class="string">&#x27;rfm_group&#x27;</span>, <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;number&#x27;</span>]</span><br><span class="line"><span class="comment"># 细节: 把number列的类型 -&gt; int类型.</span></span><br><span class="line">display_data[<span class="string">&#x27;number&#x27;</span>] = display_data[<span class="string">&#x27;number&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">display_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.3 绘制图形【这里不需要敲，直接复制即可】</span></span><br><span class="line"><span class="comment"># 颜色池</span></span><br><span class="line">range_color = [<span class="string">&#x27;#313695&#x27;</span>, <span class="string">&#x27;#4575b4&#x27;</span>, <span class="string">&#x27;#74add1&#x27;</span>, <span class="string">&#x27;#abd9e9&#x27;</span>, <span class="string">&#x27;#e0f3f8&#x27;</span>, <span class="string">&#x27;#ffffbf&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;#fee090&#x27;</span>, <span class="string">&#x27;#fdae61&#x27;</span>, <span class="string">&#x27;#f46d43&#x27;</span>, <span class="string">&#x27;#d73027&#x27;</span>, <span class="string">&#x27;#a50026&#x27;</span>]</span><br><span class="line"></span><br><span class="line">range_max = <span class="built_in">int</span>(display_data[<span class="string">&#x27;number&#x27;</span>].<span class="built_in">max</span>())</span><br><span class="line">c = (</span><br><span class="line">    Bar3D()<span class="comment">#设置了一个3D柱形图对象</span></span><br><span class="line">    .add(</span><br><span class="line">        <span class="string">&quot;&quot;</span>,<span class="comment">#图例</span></span><br><span class="line">        [d.tolist() <span class="keyword">for</span> d <span class="keyword">in</span> display_data.values],<span class="comment">#数据</span></span><br><span class="line">        xaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;category&quot;</span>, name=<span class="string">&#x27;分组名称&#x27;</span>),<span class="comment">#x轴数据类型，名称，rfm_group</span></span><br><span class="line">        yaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;category&quot;</span>, name=<span class="string">&#x27;年份&#x27;</span>),<span class="comment">#y轴数据类型，名称，year</span></span><br><span class="line">        zaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;value&quot;</span>, name=<span class="string">&#x27;会员数量&#x27;</span>),<span class="comment">#z轴数据类型，名称，number</span></span><br><span class="line">    )</span><br><span class="line">    .set_global_opts( <span class="comment"># 全局设置</span></span><br><span class="line">        visualmap_opts=opts.VisualMapOpts(max_=range_max, range_color=range_color), <span class="comment">#设置颜色，及不同取值对应的颜色</span></span><br><span class="line">        title_opts=opts.TitleOpts(title=<span class="string">&quot;RFM分组结果&quot;</span>),<span class="comment">#设置标题</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">c.render() 		      <span class="comment"># 数据保存到本地的网页中.</span></span><br></pre></td></tr></table></figure>



<h2 id="代码带详细注释"><a href="#代码带详细注释" class="headerlink" title="代码带详细注释"></a>代码带详细注释</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  time  <span class="comment">#：用来记录插入数据库时的当前日期</span></span><br><span class="line"><span class="keyword">import</span>  numpy <span class="comment">#：用来做基本数据处理等</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="comment"># pyecharts：展示3D柱形图   pip install pyecharts</span></span><br><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> Bar3D         </span><br><span class="line"><span class="keyword">from</span> pyecharts.commons.utils <span class="keyword">import</span> JsCode</span><br><span class="line"><span class="keyword">import</span> pyecharts.options <span class="keyword">as</span> opts</span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">os.chdir(<span class="string">r&quot;E:\workspace\&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#2、加载数据</span></span><br><span class="line"><span class="string">#2-1、定义列表  记录excel每一个sheet页名字</span></span><br><span class="line"><span class="string">sheet_names=[&#x27;2015&#x27;,&#x27;2016&#x27;,&#x27;2017&#x27;,&#x27;2018&#x27;,&#x27;会员等级&#x27;]</span></span><br><span class="line"><span class="string">#2-2 读取excel里面的数据</span></span><br><span class="line"><span class="string">#参1: excel文件路径</span></span><br><span class="line"><span class="string">#参2：excel文件里面的sheet页的名字</span></span><br><span class="line"><span class="string">#详解： read_excel 读取的数据 是字典类型-》&#123;&#x27;2015&#x27;:df对象,&#x27;2016&#x27;:df对象,&#x27;2017&#x27;:df对象...&#125;</span></span><br><span class="line"><span class="string">sheet_dict=pd.read_excel(&#x27;./data/sales.xlsx&#x27;,sheet_name=sheet_names)</span></span><br><span class="line"><span class="string">sheet_dict</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#2-7 查看字典中的每个df对象（即：每张sheet表）的基本信息和统计信息</span></span><br><span class="line"><span class="string">for i in sheet_names:</span></span><br><span class="line"><span class="string">    print(i)     #i -&gt;每个sheet表名</span></span><br><span class="line"><span class="string">    #打印基本信息和基本统计信息</span></span><br><span class="line"><span class="string">    print(sheet_dict[i].info())</span></span><br><span class="line"><span class="string">    print(sheet_dict[i].describe())</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#3- 数据的预处理</span></span><br><span class="line"><span class="string">    #3-1 需要预处理动作</span></span><br><span class="line"><span class="string">        # 1：删除缺失值</span></span><br><span class="line"><span class="string">        # 2：过滤出金额&gt;1订单</span></span><br><span class="line"><span class="string">        # 3：固定时间节点，以每年的最后1天作为当年分析节点</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#3-2 遍历  ，获取每张表的数据（除了最后一张）</span></span><br><span class="line"><span class="string">for i in sheet_names[:-1]:   # sheet_names[0:4]:</span></span><br><span class="line"><span class="string">    # print(i)</span></span><br><span class="line"><span class="string">    #3-2-1:删除缺失值</span></span><br><span class="line"><span class="string">    sheet_dict[i]=sheet_dict[i].dropna()</span></span><br><span class="line"><span class="string">    #3-2-2:过滤出金额&gt;1的值</span></span><br><span class="line"><span class="string">    #sheet_dict[i][&#x27;订单金额&#x27;]&gt;1（dataframe）</span></span><br><span class="line"><span class="string">    sheet_dict[i]=sheet_dict[i][sheet_dict[i][&#x27;订单金额&#x27;]&gt;1]</span></span><br><span class="line"><span class="string">    #3-2-3:以每年的最后1天作为当年分析节点</span></span><br><span class="line"><span class="string">    sheet_dict[i][&#x27;max_year_date&#x27;]=sheet_dict[i][&#x27;提交日期&#x27;].max()</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"># 3-3  查看处理后的数据</span></span><br><span class="line"><span class="string">for i in sheet_names:</span></span><br><span class="line"><span class="string">    print(i)</span></span><br><span class="line"><span class="string">    print(sheet_dict[i].info())</span></span><br><span class="line"><span class="string">    print(sheet_dict[i].describe())</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#3-4 把上述四张表（对应的4个df对象）合并为1个df对象</span></span><br><span class="line"><span class="string"># sheet_dict[&#x27;2015&#x27;]</span></span><br><span class="line"><span class="string"># sheet_dict[&#x27;2016&#x27;]</span></span><br><span class="line"><span class="string"># ...</span></span><br><span class="line"><span class="string"># 目标：合并2015、2016、2017、2018 怎么办？</span></span><br><span class="line"><span class="string"># 分析：sheet_dict 字典格式 &#123;&#x27;2015&#x27;:df对象,&#x27;2016&#x27;:df对象,&#x27;2017&#x27;:df对象&#125;</span></span><br><span class="line"><span class="string"># 所以：sheet_dict.values 但是dict_values类型 ，concat需要列表</span></span><br><span class="line"><span class="string"># 所以：list(sheet_dict.values()) 如果这样的话，会员表也合并进去了，list[:-1]去掉会员表</span></span><br><span class="line"><span class="string">#技术解决方案：concat()</span></span><br><span class="line"><span class="string">df_concat=pd.concat(list(sheet_dict.values())[:-1],ignore_index=True)   #合并后需要重置索引   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#3-5:为了好区分：df_concat对象新增列 year列</span></span><br><span class="line"><span class="string">df_concat[&#x27;year&#x27;]=df_concat[&#x27;提交日期&#x27;].dt.year</span></span><br><span class="line"><span class="string">df_concat</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#3-6 给表新增1列 ，data_interval 表示本订单购买时间 距离 统计 时间节点的差值</span></span><br><span class="line"><span class="string">df_concat[&#x27;data_interval&#x27;]=df_concat[&#x27;max_year_date&#x27;]-df_concat[&#x27;提交日期&#x27;]</span></span><br><span class="line"><span class="string"># df_concat.info()</span></span><br><span class="line"><span class="string">#3-7 处理间隔时间中 days</span></span><br><span class="line"><span class="string">df_concat[&#x27;data_interval&#x27;]=df_concat[&#x27;data_interval&#x27;].dt.days</span></span><br><span class="line"><span class="string">df_concat</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#as_index=False 不要把分组字段设置索引</span></span><br><span class="line"><span class="string">#4、计算R：最近购买时间   F：购买次数   M：购买金额</span></span><br><span class="line"><span class="string">#4-1 基于year 和会员ID分组 ，统计 RFM的基本数据</span></span><br><span class="line"><span class="string">rfm_gb=df_concat.groupby([&#x27;year&#x27;,&#x27;会员ID&#x27;],as_index=False).agg(</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &#x27;data_interval&#x27;:&#x27;min&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;订单号&#x27;:&#x27;count&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;订单金额&#x27;:&#x27;sum&#x27;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">rfm_gb</span></span><br><span class="line"><span class="string">#4-2 :修改列名</span></span><br><span class="line"><span class="string">rfm_gb.columns=[&#x27;year&#x27;,&#x27;会员ID&#x27;,&#x27;r&#x27;,&#x27;f&#x27;,&#x27;m&#x27;]</span></span><br><span class="line"><span class="string">rfm_gb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#5、 分析 RFM 值的分布情况</span></span><br><span class="line"><span class="string">rfm_gb.iloc[:,2:].describe().T</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#5-1 划分区间  分别给出 RFM评分：</span></span><br><span class="line"><span class="string"># r：最近一次购买时间 越小分越高</span></span><br><span class="line"><span class="string"># f： 购买次数      越大分越高</span></span><br><span class="line"><span class="string"># m： 购买金额      越大分越高</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#思路1： 我们给定区间数，用系统根据数据自动划分区间</span></span><br><span class="line"><span class="string"># pd.cut(rfm_gb[&#x27;r&#x27;],bins=3).unique()</span></span><br><span class="line"><span class="string"># [(-0.365, 121.667], (243.333, 365.0],(121.667, 243.333]]  #包右不包左</span></span><br><span class="line"><span class="string">#  不包括           包括 不包括        包括 不包括           包括   </span></span><br><span class="line"><span class="string">#        3                   2                    1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pd.cut(rfm_gb[&#x27;f&#x27;],bins=3).unique()</span></span><br><span class="line"><span class="string"># [(-204.75, 68751.6], (68751.6, 137501.7], (137501.7, 206251.8]]</span></span><br><span class="line"><span class="string">#          1                   2                   3 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#思路2：我们手动的指定区间范围 ，由系统自动划分区间数据  </span></span><br><span class="line"><span class="string"># 提问：我们想划分几个区间 ？3个区间  ，需要4个值 ，就可以划分三个区间</span></span><br><span class="line"><span class="string">r_bins=[-1,79,255,365]</span></span><br><span class="line"><span class="string">f_bins=[0,2,5,130]</span></span><br><span class="line"><span class="string">m_bins=[1,69,1199,206300]</span></span><br><span class="line"><span class="string">pd.cut(rfm_gb[&#x27;r&#x27;],bins=r_bins).unique()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#思路3： 基于我们手动指定区间范围 ，给出每个范围评分（三分法 ： 低（1）中（2）高（3））</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;r_label&#x27;]=pd.cut(rfm_gb[&#x27;r&#x27;],bins=r_bins,labels=[3,2,1])  # r值（最近购买间隔）越小，分越高</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;f_label&#x27;]=pd.cut(rfm_gb[&#x27;f&#x27;],bins=f_bins,labels=[1,2,3])    #f值（购买次数）越大，分越高</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;m_label&#x27;]=pd.cut(rfm_gb[&#x27;m&#x27;],bins=m_bins,labels=[1,2,3])                     #m值（购买金额）越大，分越高</span></span><br><span class="line"><span class="string">rfm_gb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 思路3_实际开发写法  （完整版）   因为后期可能改为4分、5分法 ，这里写死了，不太好，可以灵活应对</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;r_label&#x27;]=pd.cut(rfm_gb[&#x27;r&#x27;],bins=r_bins,labels=[i for i in range(len(r_bins)-1,0,-1)]) </span></span><br><span class="line"><span class="string">rfm_gb[&#x27;f_label&#x27;]=pd.cut(rfm_gb[&#x27;f&#x27;],bins=f_bins,labels=[i for i in range(1,len(f_bins))]) </span></span><br><span class="line"><span class="string">rfm_gb[&#x27;m_label&#x27;]=pd.cut(rfm_gb[&#x27;m&#x27;],bins=m_bins,labels=[i for i in range(1,len(m_bins))]) </span></span><br><span class="line"><span class="string">rfm_gb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#6、 RFM计算结果处理</span></span><br><span class="line"><span class="string"> # #6-1 处理方式有两个</span></span><br><span class="line"><span class="string"> #      6-1-1：拼接   因为我们是面向销售人员，他们需要分析用户的不同维度打分，制定不用的营销和运营方案 ，方便分析客户</span></span><br><span class="line"><span class="string"> #      6-1-2：累加  </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">#第一步：类型转换 把 r_babel   f_label  m_label   分类类型 转换为字符串类型</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;r_label&#x27;]=rfm_gb[&#x27;r_label&#x27;].astype(str)</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;f_label&#x27;]=rfm_gb[&#x27;f_label&#x27;].astype(str)</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;m_label&#x27;]=rfm_gb[&#x27;m_label&#x27;].astype(str)</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">#第二步：拼接评分</span></span><br><span class="line"><span class="string">rfm_gb[&#x27;rfm_group&#x27;]=rfm_gb[&#x27;r_label&#x27;]+rfm_gb[&#x27;f_label&#x27;]+rfm_gb[&#x27;m_label&#x27;]</span></span><br><span class="line"><span class="string">rfm_gb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#7、结果数据保存</span></span><br><span class="line"><span class="string">#7-1 保存到excel </span></span><br><span class="line"><span class="string">rfm_gb.to_excel(&#x27;./data/sales_rfm_score1.xlsx&#x27;,index=False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#7-2 保存mysql表中</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#1、创建引擎对象</span></span><br><span class="line"><span class="string"># mysql+mysqldb://scott:tiger@hostname/dbname&quot;</span>,pool_recycle=<span class="number">3600</span></span><br><span class="line">engine=create_engine(<span class="string">&#x27;mysql+pymysql://root:root@localhost:3306/rfm_db?charset=utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2、具体导出数据到MySQL表中</span></span><br><span class="line">rfm_gb.to_sql(<span class="string">&#x27;sales_rfm_score&#x27;</span>,engine,index=<span class="literal">False</span>,if_exists=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7-3 pyecharts 交付</span></span><br><span class="line"><span class="comment"># 5.1 准备可视化的数据, 即: rfm_group(分组结果评分), year(统计年份), number(评分个数)</span></span><br><span class="line">display_data = rfm_gb.groupby([<span class="string">&#x27;rfm_group&#x27;</span>, <span class="string">&#x27;year&#x27;</span>], as_index=<span class="literal">False</span>).agg(&#123;<span class="string">&#x27;会员ID&#x27;</span>: <span class="string">&#x27;count&#x27;</span>&#125;)</span><br><span class="line">display_data</span><br><span class="line"><span class="comment"># 5.2 修改列名.</span></span><br><span class="line">display_data.columns = [<span class="string">&#x27;rfm_group&#x27;</span>, <span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;number&#x27;</span>]</span><br><span class="line"><span class="comment"># 细节: 把number列的类型 -&gt; int类型.</span></span><br><span class="line">display_data[<span class="string">&#x27;number&#x27;</span>] = display_data[<span class="string">&#x27;number&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">display_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.3 绘制图形【这里不需要敲，直接复制即可】</span></span><br><span class="line"><span class="comment"># 颜色池</span></span><br><span class="line">range_color = [<span class="string">&#x27;#313695&#x27;</span>, <span class="string">&#x27;#4575b4&#x27;</span>, <span class="string">&#x27;#74add1&#x27;</span>, <span class="string">&#x27;#abd9e9&#x27;</span>, <span class="string">&#x27;#e0f3f8&#x27;</span>, <span class="string">&#x27;#ffffbf&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;#fee090&#x27;</span>, <span class="string">&#x27;#fdae61&#x27;</span>, <span class="string">&#x27;#f46d43&#x27;</span>, <span class="string">&#x27;#d73027&#x27;</span>, <span class="string">&#x27;#a50026&#x27;</span>]</span><br><span class="line"></span><br><span class="line">range_max = <span class="built_in">int</span>(display_data[<span class="string">&#x27;number&#x27;</span>].<span class="built_in">max</span>())</span><br><span class="line">c = (</span><br><span class="line">    Bar3D()<span class="comment">#设置了一个3D柱形图对象</span></span><br><span class="line">    .add(</span><br><span class="line">        <span class="string">&quot;&quot;</span>,<span class="comment">#图例</span></span><br><span class="line">        [d.tolist() <span class="keyword">for</span> d <span class="keyword">in</span> display_data.values],<span class="comment">#数据</span></span><br><span class="line">        xaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;category&quot;</span>, name=<span class="string">&#x27;分组名称&#x27;</span>),<span class="comment">#x轴数据类型，名称，rfm_group</span></span><br><span class="line">        yaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;category&quot;</span>, name=<span class="string">&#x27;年份&#x27;</span>),<span class="comment">#y轴数据类型，名称，year</span></span><br><span class="line">        zaxis3d_opts=opts.Axis3DOpts(type_=<span class="string">&quot;value&quot;</span>, name=<span class="string">&#x27;会员数量&#x27;</span>),<span class="comment">#z轴数据类型，名称，number</span></span><br><span class="line">    )</span><br><span class="line">    .set_global_opts( <span class="comment"># 全局设置</span></span><br><span class="line">        visualmap_opts=opts.VisualMapOpts(max_=range_max, range_color=range_color), <span class="comment">#设置颜色，及不同取值对应的颜色</span></span><br><span class="line">        title_opts=opts.TitleOpts(title=<span class="string">&quot;RFM分组结果&quot;</span>),<span class="comment">#设置标题</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">c.render() 		      <span class="comment"># 数据保存到本地的网页中.</span></span><br></pre></td></tr></table></figure>



<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><blockquote>
<p>为什么使用Pandas：</p>
<ul>
<li><strong>以Numpy为基础，借力Numpy模块在计算方面性能高的优势</strong></li>
<li><strong>基于matplotlib，能够简便的画图</strong></li>
<li><strong>独特的数据结构</strong></li>
<li><strong>读取文件方便</strong></li>
<li><strong>封装了Matplotlib、Numpy的画图和计算</strong></li>
</ul>
</blockquote>
<h2 id="举例论证"><a href="#举例论证" class="headerlink" title="举例论证"></a>举例论证</h2><ul>
<li><p>增强图表可读性</p>
<ul>
<li>在numpy当中创建学生成绩表样式：</li>
</ul>
</li>
<li><p>返回结果：</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">array([[<span class="number">92</span>, <span class="number">55</span>, <span class="number">78</span>, <span class="number">50</span>, <span class="number">50</span>],</span><br><span class="line">       [<span class="number">71</span>, <span class="number">76</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">96</span>],</span><br><span class="line">       [<span class="number">45</span>, <span class="number">84</span>, <span class="number">78</span>, <span class="number">51</span>, <span class="number">68</span>],</span><br><span class="line">       [<span class="number">81</span>, <span class="number">91</span>, <span class="number">56</span>, <span class="number">54</span>, <span class="number">76</span>],</span><br><span class="line">       [<span class="number">86</span>, <span class="number">66</span>, <span class="number">77</span>, <span class="number">67</span>, <span class="number">95</span>],</span><br><span class="line">       [<span class="number">46</span>, <span class="number">86</span>, <span class="number">56</span>, <span class="number">61</span>, <span class="number">99</span>],</span><br><span class="line">       [<span class="number">46</span>, <span class="number">95</span>, <span class="number">44</span>, <span class="number">46</span>, <span class="number">56</span>],</span><br><span class="line">       [<span class="number">80</span>, <span class="number">50</span>, <span class="number">45</span>, <span class="number">65</span>, <span class="number">57</span>],</span><br><span class="line">       [<span class="number">41</span>, <span class="number">93</span>, <span class="number">90</span>, <span class="number">41</span>, <span class="number">97</span>],</span><br><span class="line">       [<span class="number">65</span>, <span class="number">83</span>, <span class="number">57</span>, <span class="number">57</span>, <span class="number">40</span>]])</span><br></pre></td></tr></table></figure>

<p>如果数据展示为这样，可读性就会更友好：</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240812222353841.png" alt="image-20240812222353841"></p>
<h1 id="Pandas数据结构"><a href="#Pandas数据结构" class="headerlink" title="Pandas数据结构"></a>Pandas数据结构</h1><blockquote>
<p>Pandas中一共有三种数据类型，分别为：Series、DataFrame和MultiIndex（老版本中叫Panel ）。</p>
<p>其中Series是一维数据类型，DataFrame是二维的表格型数据类型，MultiIndex是三维的数据类型。</p>
</blockquote>
<h2 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h2><blockquote>
<p>Pandas中的Series类似于线性代数中的列向量(补充：也可以是行向量)。</p>
<ul>
<li>pd.Series(data, index, dtype)：创建一个列向量<ul>
<li>注意：data可以为数组，也可以为字典</li>
<li>同时，在如果是一个数组的时候可以指定索引，也就是index前面的data每一个数字的索引位置</li>
</ul>
</li>
<li>Series.index：获取该列向量的全部索引index</li>
<li>Series.values：获取该列向量所有的数值data</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建Series</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 从Pandas开始，使用正规的打印输出</span></span><br><span class="line"><span class="built_in">print</span>(pd.Series(data=<span class="literal">None</span>, index=<span class="literal">None</span>, dtype=<span class="literal">None</span>))</span><br><span class="line"><span class="comment"># 不指定索引和数据类型，直接创建一个series</span></span><br><span class="line"><span class="built_in">print</span>(pd.Series(np.arange(<span class="number">10</span>)))</span><br><span class="line"><span class="comment"># np.arange(10)  # array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Series时指定索引和数据类型</span></span><br><span class="line"><span class="built_in">print</span>(pd.Series([<span class="number">6.7</span>,<span class="number">5.6</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">2</span>], [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过字典数据创建</span></span><br><span class="line"><span class="built_in">print</span>(pd.Series(&#123;<span class="string">&#x27;red&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;blue&#x27;</span>:<span class="number">200</span>, <span class="string">&#x27;green&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;yellow&#x27;</span>:<span class="number">1000</span>&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Series的属性:index, values(类似于字典中的键值对的键和值)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">color_series = pd.Series(&#123;<span class="string">&#x27;red&#x27;</span>:<span class="number">100</span>, <span class="string">&#x27;blue&#x27;</span>:<span class="number">200</span>, <span class="string">&#x27;green&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;yellow&#x27;</span>:<span class="number">1000</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(color_series.index)</span><br><span class="line"><span class="built_in">print</span>(color_series.values)</span><br><span class="line"><span class="comment"># 使用索引来获取数据</span></span><br><span class="line"><span class="built_in">print</span>(color_series[<span class="string">&#x27;red&#x27;</span>])</span><br></pre></td></tr></table></figure>



<h2 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h2><p>DataFrame相当于线性代数中的矩阵。</p>
<p>除了注意DataFrame中的数据，DataFrame中的行列索引也是比较重要的东西。</p>
<p>怕弄混，这里搞个图片标记一下。</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240823223945178.png" alt="image-20240823223945178"></p>
<blockquote>
<ul>
<li>pd.DataFrame(data, index, colunms)：创建一个DataFrame<ul>
<li>注意：传入的Data必须为二维数组</li>
</ul>
</li>
<li>pd.DataFrame(df, column, index)：给一个已知的DataFrame重新添加索引<ul>
<li>注意：column是横的，index是竖的就行了</li>
</ul>
</li>
<li>df.shape：输出当前DataFrame(df)的形状<ul>
<li>下面的data就是DataFrame</li>
</ul>
</li>
<li>data.index ： 行索引列表</li>
<li>data.columns  ： 列索引列表</li>
<li>data.values  ： 取其中array的值，类似于numpy的原始数据类型</li>
<li>data.T   ： 将data进行转置(10, 5) -&gt; (5, 10)</li>
<li>data.head(5)： 只显示data前五行的内容</li>
<li>data.tail(5) ： 只显示data后五行的内容</li>
<li>df.index &#x3D; [列表]：修改列索引（也就是修改竖的的那个索引</li>
<li>df.reset_index(drop&#x3D;True&#x2F;False)：重新设置新的索引</li>
<li>df.set_index(‘month’)：设置月份为当前DataFrame的索引<ul>
<li>注意：一个DataFrame可以设置多个字段为索引，但是需要用[]列表的形式表示</li>
<li>如：df.set_index([‘year’, ‘month’])</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建DataFrame</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(pd.DataFrame(data=<span class="literal">None</span>, index=<span class="literal">None</span>, columns=<span class="literal">None</span>))</span><br><span class="line"><span class="built_in">print</span>(np.random.randn(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.randn是numpy的一个函数，从标准正态分布函数中随机生成随机数并指定形状为2行3列</span></span><br><span class="line">unipd = pd.DataFrame(np.random.randn(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通的numpy结构和DataFrame对比</span></span><br><span class="line">score = np.random.randint(<span class="number">40</span>,<span class="number">100</span>,(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;生成10行5列的40-100之间的随机数为&quot;</span>,score)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面直接生成可读性比较差，可以使用pandas的DataFrame让数据更有意义</span></span><br><span class="line">score_df = pd.DataFrame(score)</span><br><span class="line"><span class="built_in">print</span>(score_df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于上面的行列标签都是从0开始的数字，可以手动构造索引序列</span></span><br><span class="line"><span class="comment"># 构造列索引序列</span></span><br><span class="line">subject = [<span class="string">&quot;语文&quot;</span>, <span class="string">&quot;数学&quot;</span>, <span class="string">&quot;英语&quot;</span>, <span class="string">&quot;政治&quot;</span>, <span class="string">&quot;体育&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造行索引序列</span></span><br><span class="line">stu = [<span class="string">&#x27;同学&#x27;</span>+ <span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(score_df.shape[<span class="number">0</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加行，列索引</span></span><br><span class="line">data = pd.DataFrame(score, columns=subject, index=stu)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#      语文  数学  英语  政治  体育</span></span><br><span class="line"><span class="comment"># 同学0  83  90  71  44  57</span></span><br><span class="line"><span class="comment"># 同学1  79  69  84  81  84</span></span><br><span class="line"><span class="comment"># 同学2  58  67  64  77  93</span></span><br><span class="line"><span class="comment"># .....</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DataFrame的属性</span></span><br><span class="line">data.shape   <span class="comment"># (10, 5)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;DataFrame的形状的行数为:&quot;</span>, score_df.shape[<span class="number">0</span>])  <span class="comment"># 10行，所以上面等价与 for i in range(10)</span></span><br><span class="line">data.index  <span class="comment"># 行索引列表</span></span><br><span class="line">data.columns   <span class="comment"># 列索引列表</span></span><br><span class="line">data.values   <span class="comment"># 取其中array的值，类似于numpy的原始数据类型</span></span><br><span class="line">data.T   <span class="comment"># 将data进行转置(10, 5) -&gt; (5, 10)</span></span><br><span class="line">data.head(<span class="number">5</span>)  <span class="comment"># 只显示data前五行的内容</span></span><br><span class="line">data.tail(<span class="number">5</span>)  <span class="comment"># 只显示data后五行的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改行列索引的值</span></span><br><span class="line">stu = [<span class="string">&quot;天朝学生_&quot;</span> + <span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(score_df.shape[<span class="number">0</span>])]</span><br><span class="line">data.index = stu</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新设置索引  reset_index(drop=False)</span></span><br><span class="line">data.reset_index(drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置新的索引</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;month&#x27;</span>: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>],</span><br><span class="line">                    <span class="string">&#x27;year&#x27;</span>: [<span class="number">2012</span>, <span class="number">2014</span>, <span class="number">2013</span>, <span class="number">2014</span>],</span><br><span class="line">                    <span class="string">&#x27;sale&#x27;</span>:[<span class="number">55</span>, <span class="number">40</span>, <span class="number">84</span>, <span class="number">31</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以月份设置新的索引</span></span><br><span class="line">df.set_index(<span class="string">&#x27;month&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以年份和月份设置多个索引</span></span><br><span class="line">df.set_index([<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>])</span><br></pre></td></tr></table></figure>



<h2 id="MultiIndex与Panel"><a href="#MultiIndex与Panel" class="headerlink" title="MultiIndex与Panel"></a>MultiIndex与Panel</h2><blockquote>
<p> MultiIndex是三维的数据类型;</p>
<p> 多级索引（也称层次化索引）是pandas的重要功能，可以在Series、DataFrame对象上拥有2个以及2个以上的索引。</p>
<p> 其实简单理解就是多级索引，想象一张成绩表，张三学生下面有很多的学科，每一门学科都有各自的成绩。</p>
<p> 再比如将数据分为1和2组，下面是pandas跑出来的结果：</p>
<p> <img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240823215403703.png" alt="image-20240823215403703"></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># MultiIndex是三维的数据类型; </span></span><br><span class="line"><span class="comment"># 多级索引（也称层次化索引）是pandas的重要功能，可以在Series、DataFrame对象上拥有2个以及2个以上的索引。</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;month&#x27;</span>: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>],</span><br><span class="line">                    <span class="string">&#x27;year&#x27;</span>: [<span class="number">2012</span>, <span class="number">2014</span>, <span class="number">2013</span>, <span class="number">2014</span>],</span><br><span class="line">                    <span class="string">&#x27;sale&#x27;</span>:[<span class="number">55</span>, <span class="number">40</span>, <span class="number">84</span>, <span class="number">31</span>]&#125;)</span><br><span class="line">df.index</span><br><span class="line"></span><br><span class="line"><span class="comment"># multiIndex 的创建</span></span><br><span class="line">arrays = [[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>]]</span><br><span class="line">mi_index = pd.MultiIndex.from_arrays(arrays, names=(<span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;color&#x27;</span>))</span><br><span class="line">mi_index</span><br><span class="line">mi_df = pd.DataFrame(np.random.normal(size=(<span class="number">4</span>,<span class="number">4</span>)),index=mi_index)   <span class="comment"># 创建四行四列的数组，行索引指定为mi_index</span></span><br><span class="line">mi_df</span><br><span class="line"></span><br><span class="line"><span class="comment"># Panel: 用于存储三维数组</span></span><br><span class="line">p = pd.Panel(data=np.arange(<span class="number">24</span>).reshape(<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>),</span><br><span class="line">                 items=<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>),</span><br><span class="line">                 major_axis=pd.date_range(<span class="string">&#x27;20130101&#x27;</span>, periods=<span class="number">3</span>),</span><br><span class="line">                 minor_axis=[<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>])</span><br><span class="line"><span class="comment"># 查看panel的数据</span></span><br><span class="line">p</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.panel.Panel&#x27;&gt;</span></span><br><span class="line"><span class="comment"># Dimensions: 4 (items) x 3 (major_axis) x 2 (minor_axis)</span></span><br><span class="line"><span class="comment"># Items axis: A to D</span></span><br><span class="line"><span class="comment"># Major_axis axis: 2013-01-01 00:00:00 to 2013-01-03 00:00:00</span></span><br><span class="line"><span class="comment"># Minor_axis axis: first to second</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看panel的数据</span></span><br><span class="line">p[:,:,<span class="string">&quot;first&quot;</span>]</span><br><span class="line"><span class="comment"># 	A	B	C	D</span></span><br><span class="line"><span class="comment"># 2013-01-01	0	6	12	18</span></span><br><span class="line"><span class="comment"># 2013-01-02	2	8	14	20</span></span><br><span class="line"><span class="comment"># 2013-01-03	4	10	16	22</span></span><br><span class="line"></span><br><span class="line">p[<span class="string">&quot;B&quot;</span>,:,:]</span><br><span class="line"><span class="comment"># first	second</span></span><br><span class="line"><span class="comment"># 2013-01-01	6	7</span></span><br><span class="line"><span class="comment"># 2013-01-02	8	9</span></span><br><span class="line"><span class="comment"># 2013-01-03	10	11</span></span><br></pre></td></tr></table></figure>

<h1 id="Pandas的索引、切片基操"><a href="#Pandas的索引、切片基操" class="headerlink" title="Pandas的索引、切片基操"></a>Pandas的索引、切片基操</h1><blockquote>
<p>首先引入文件操作，Pandas支持读取的文件为CSV、SQL、XLS、JSON、HDF5。</p>
<p>注：最常用的HDF5和CSV文件</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取文件</span></span><br><span class="line">data = pd.read_csv(<span class="string">&quot;./data/stock_day.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除一些列，让数据更简单些，再去做后面的操作</span></span><br><span class="line">data = data.drop([<span class="string">&quot;ma5&quot;</span>,<span class="string">&quot;ma10&quot;</span>,<span class="string">&quot;ma20&quot;</span>,<span class="string">&quot;v_ma5&quot;</span>,<span class="string">&quot;v_ma10&quot;</span>,<span class="string">&quot;v_ma20&quot;</span>], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h2 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h2><blockquote>
<ul>
<li>df[‘字段名称’]：取出某个DataFrame中的某一列</li>
<li>df[‘列索引’][‘行索引’]：精确找到列索引+行索引所确定的某个值</li>
<li>df.drop([‘字段1’, ‘字段2’….])：裁剪DataFrame，使列表里面的字段全部不显示or生成新的DataFrame</li>
<li>df.loc[行，列]：这个是先行后列，也都是字段名称，跟上面第二个相反</li>
<li>df.iloc[行索引下标，列索引下标]：这个iloc跟loc最大的区别就是iloc可以通过索引下标操作</li>
<li>df.ix[行，列索引下标]：这个ix’就是将上面loc和iloc混在一块了，然后导致后面也用的比较少，就过时了</li>
<li>最重要的还是loc和iloc的组合操作</li>
<li>df.index[下标切片]：获取DataFrame指定下标的索引，返回的是具体数字</li>
<li>df.columns().get_indexer([字段1，字段2])：获取字段的列下标，返回的是下标</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;./stock_day.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"><span class="comment"># 删除一些列，让数据变得更简单一些，再去做后面的操作</span></span><br><span class="line">data = data.drop([<span class="string">&quot;ma5&quot;</span>,<span class="string">&quot;ma10&quot;</span>,<span class="string">&quot;ma20&quot;</span>,<span class="string">&quot;v_ma5&quot;</span>,<span class="string">&quot;v_ma10&quot;</span>,<span class="string">&quot;v_ma20&quot;</span>], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用行列索引操作数据(先列后行)</span></span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;open&#x27;</span>][<span class="string">&#x27;2018-02-27&#x27;</span>])  <span class="comment"># 23.53</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用loc和iloc进行行列索引操作（这个跟直接使用行列索引的顺序刚好相反）</span></span><br><span class="line">data.loc[<span class="string">&#x27;2018-02-27&#x27;</span>: <span class="string">&#x27;2018-02-22&#x27;</span>, <span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"><span class="comment"># 2018-02-27    23.53</span></span><br><span class="line"><span class="comment"># 2018-02-26    22.80</span></span><br><span class="line"><span class="comment"># 2018-02-23    22.88</span></span><br><span class="line"><span class="comment"># 2018-02-22    22.25</span></span><br><span class="line"><span class="comment"># Name: open, dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用iloc可以使用数组下标去操作-获取前三天，前五列的数据</span></span><br><span class="line">data.iloc[:<span class="number">3</span>, :<span class="number">5</span>]</span><br><span class="line"><span class="comment"># 	open	high	close	low	volume</span></span><br><span class="line"><span class="comment"># 2018-02-27	23.53	25.88	24.16	23.53	95578.03</span></span><br><span class="line"><span class="comment"># 2018-02-26	22.80	23.78	23.53	22.80	60985.11</span></span><br><span class="line"><span class="comment"># 2018-02-23	22.88	23.37	22.82	22.71	52914.01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ix组合索引（现在已经过时了）</span></span><br><span class="line"><span class="comment"># Warning:Starting in 0.20.0, the .ix indexer is deprecated, in favor of the more strict .iloc and .loc indexers.</span></span><br><span class="line"><span class="comment"># 使用ix进行下标和名称组合做引</span></span><br><span class="line">data.ix[<span class="number">0</span>:<span class="number">4</span>, [<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;close&#x27;</span>, <span class="string">&#x27;high&#x27;</span>, <span class="string">&#x27;low&#x27;</span>]]</span><br><span class="line"><span class="comment"># 	open	close	high	low</span></span><br><span class="line"><span class="comment"># 2018-02-27	23.53	24.16	25.88	23.53</span></span><br><span class="line"><span class="comment"># 2018-02-26	22.80	23.53	23.78	22.80</span></span><br><span class="line"><span class="comment"># 2018-02-23	22.88	22.82	23.37	22.71</span></span><br><span class="line"><span class="comment"># 2018-02-22	22.25	22.28	22.76	22.02</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推荐使用loc和iloc的方式来获取数据的方式</span></span><br><span class="line">data.loc[data.index[<span class="number">0</span>:<span class="number">4</span>], [<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;close&#x27;</span>, <span class="string">&#x27;high&#x27;</span>, <span class="string">&#x27;low&#x27;</span>]]  <span class="comment"># 获取的结果同上-ix方式</span></span><br><span class="line">data.iloc[<span class="number">0</span>:<span class="number">4</span>, data.columns.get_indexer([<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;close&#x27;</span>, <span class="string">&#x27;high&#x27;</span>, <span class="string">&#x27;low&#x27;</span>])]  <span class="comment"># 获取的结果同上</span></span><br></pre></td></tr></table></figure>

<h2 id="赋值操作"><a href="#赋值操作" class="headerlink" title="赋值操作"></a>赋值操作</h2><blockquote>
<ul>
<li>df[‘字段’] &#x3D;  固定数值：改变DataFrame中某一列的全部值<ul>
<li>df.字段 &#x3D; 固定值：这个效果和上面的效果相同</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对DataFrame中的close列重新赋值为1</span></span><br><span class="line">data[<span class="string">&#x27;close&#x27;</span>] = <span class="number">1</span>  <span class="comment"># 这种方法可行</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">data.high = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(data)  <span class="comment"># 这种方法也是可行的</span></span><br></pre></td></tr></table></figure>

<h2 id="排序操作"><a href="#排序操作" class="headerlink" title="排序操作"></a>排序操作</h2><blockquote>
<p><code>DataFrame排序操作分两种，一种是对内容进行排序，另一种是对索引进行排序</code></p>
<ul>
<li>对内容排序：</li>
<li>df.sort_values(by&#x3D;’字段名称’, ascending&#x3D;True&#x2F;False)：按照某个字段(股价)，升序&#x2F;降序对数据排列<ul>
<li>注意：这里的by是排序的依据，也可以是一个列表，如by&#x3D;[‘open’, ‘high’]</li>
</ul>
</li>
<li>对索引排序：</li>
<li>df.sort_index()</li>
</ul>
<p><code>Series的排序操作</code>：排序之前需要搞到一个Series，所以Series &#x3D; DataFrame[‘列名’]</p>
<ul>
<li>对内容排序：</li>
<li>Series.sort_values(ascending&#x3D;True&#x2F;False)：因为只有一列，所以不需要排序依据by</li>
<li>对索引排序：</li>
<li>Series.sort_index()：不指定ascending的话默认为升序排序</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 排序操作分为DataFrame排序和Series排序操作</span></span><br><span class="line"><span class="comment"># 一种是对索引进行排序，另一种是对内容进行排序</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对DataFrame进行排序</span></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;./stock_day.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"><span class="comment"># 删除一些列，让数据变得更简单一些，再去做后面的操作</span></span><br><span class="line">data = data.drop([<span class="string">&quot;ma5&quot;</span>,<span class="string">&quot;ma10&quot;</span>,<span class="string">&quot;ma20&quot;</span>,<span class="string">&quot;v_ma5&quot;</span>,<span class="string">&quot;v_ma10&quot;</span>,<span class="string">&quot;v_ma20&quot;</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 对内容进行排序(按照股票开盘价格进行排序，升序且只显示前几个，默认为5)</span></span><br><span class="line">data.sort_values(by=<span class="string">&quot;open&quot;</span>, ascending=<span class="literal">True</span>).head()</span><br><span class="line"><span class="comment"># 按照多个键进行排序（按照开盘价格和最高价格进行升序排序，只取前三支股票）</span></span><br><span class="line">data.sort_values(by=[<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;high&#x27;</span>]).head(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 上面的都是对内容进行排序，现在对索引进行排序，需要使用sort_index函数</span></span><br><span class="line">data.sort_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对Series进行排序</span></span><br><span class="line"><span class="comment"># Series只有一列，不需要参数(先对内容进行排序)</span></span><br><span class="line">data[<span class="string">&#x27;price_change&#x27;</span>].sort_values(ascending=<span class="literal">True</span>).head()</span><br><span class="line"><span class="comment"># Series对索引进行排序(接着就会按照索引升序排列)</span></span><br><span class="line">data[<span class="string">&#x27;p_change&#x27;</span>].sort_index().head()</span><br><span class="line"><span class="comment"># 2015-03-02    2.62</span></span><br><span class="line"><span class="comment"># 2015-03-03    1.44</span></span><br><span class="line"><span class="comment"># 2015-03-04    1.57</span></span><br><span class="line"><span class="comment"># 2015-03-05    2.02</span></span><br><span class="line"><span class="comment"># 2015-03-06    8.51</span></span><br></pre></td></tr></table></figure>

<h1 id="DataFrame运算"><a href="#DataFrame运算" class="headerlink" title="DataFrame运算"></a>DataFrame运算</h1><h2 id="算术运算-逻辑运算"><a href="#算术运算-逻辑运算" class="headerlink" title="算术运算&amp;逻辑运算"></a>算术运算&amp;逻辑运算</h2><blockquote>
<p>一般用的比较少：</p>
<ul>
<li>Series.add(常数)：DataFrame中的一个Series(某一列)加上一个常数。</li>
<li>Series.sub(常数)：同上，不想写了。</li>
<li>df[‘字段’] &gt; Integer：逻辑运算，满足上述逻辑的会输出为True</li>
<li>df.isin([列表])：条件判断，DataFrame中存在列表中的数据就会标记为True<ul>
<li>同样可以使用嵌套进行筛选，比如：data[data[‘open’].isin([23.53, 23.85])]</li>
</ul>
</li>
<li><code>df[df[&#39;字段&#39;] &gt; Integer &amp; df[&#39;字段&#39;] &lt; Integer]：嵌套逻辑，可以筛选数据</code><ul>
<li>注意：这里的与是只有一个<code>&amp;</code>，而不是通常的双与符号<code>&amp;&amp;</code></li>
</ul>
</li>
<li><code>df.query(&#39;字段 &gt; Integer &amp; 字段 &lt; Integer &#39;)：通过query进行条件筛选，常用</code></li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># DataFrame算术运算</span></span><br><span class="line">data[<span class="string">&#x27;low&#x27;</span>].add(<span class="number">1</span>)  <span class="comment"># 将data的low列每一个数值都加1</span></span><br><span class="line">data[<span class="string">&#x27;low&#x27;</span>].sub(<span class="number">1</span>)  <span class="comment"># 将data的low列每一个数值都减1 但是不会改变data本身</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑运算</span></span><br><span class="line">data[<span class="string">&#x27;open&#x27;</span>] &gt; <span class="number">23</span>  <span class="comment"># 将符合条件的数据设置为True</span></span><br><span class="line"><span class="comment"># 2018-02-27     True</span></span><br><span class="line"><span class="comment"># 2018-02-26    False</span></span><br><span class="line"><span class="comment"># 同时逻辑判断的结果可以所谓筛选数据的依据</span></span><br><span class="line">data[data[<span class="string">&#x27;open&#x27;</span>] &gt; <span class="number">25</span>]</span><br><span class="line"><span class="comment"># 	open	high	close	low	volume	price_change	p_change	turnover</span></span><br><span class="line"><span class="comment"># 2018-01-24	25.49	26.28	25.29	25.20	134838.00	-0.20	-0.79	3.37</span></span><br><span class="line"><span class="comment"># 2018-01-23	25.15	25.53	25.50	24.93	104205.76	0.39	1.55	2.61</span></span><br><span class="line"><span class="comment"># 完成多个逻辑判断</span></span><br><span class="line">data[(data[<span class="string">&#x27;open&#x27;</span>] &gt; <span class="number">23</span>) &amp; (data[<span class="string">&#x27;open&#x27;</span>] &lt; <span class="number">25</span>)].head()</span><br><span class="line"><span class="comment"># 	open	high	close	low	volume	price_change	p_change	turnover</span></span><br><span class="line"><span class="comment"># 2018-02-27	23.53	25.88	24.16	23.53	95578.03	0.63	2.68	2.39</span></span><br><span class="line"><span class="comment"># 2018-02-01	23.71	23.86	22.42	22.22	66414.64	-1.30	-5.48	1.66</span></span><br><span class="line"><span class="comment"># 2018-01-31	23.85	23.98	23.72	23.31	49155.02	-0.11	-0.46	1.23</span></span><br><span class="line"><span class="comment"># 2018-01-30	23.71	24.08	23.83	23.70	32420.43	0.05	0.21	70.81</span></span><br><span class="line"><span class="comment"># 2018-01-29	24.40	24.63	23.77	23.72	65469.81	-0.73	-2.98	1.64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑运算函数（通过query使得上面的逻辑判断更简单）</span></span><br><span class="line">data.query(<span class="string">&quot;open &gt;23 &amp; open &lt; 25&quot;</span>).head()  <span class="comment"># 执行结果同上</span></span><br><span class="line">data[<span class="string">&#x27;open&#x27;</span>].isin([<span class="number">23.53</span>, <span class="number">23.85</span>])  <span class="comment"># 显示True和False</span></span><br><span class="line"><span class="comment"># 2018-02-27     True</span></span><br><span class="line"><span class="comment"># 2018-02-26    False</span></span><br><span class="line"><span class="comment"># 作为筛选数据的依据</span></span><br><span class="line">data[data[<span class="string">&#x27;open&#x27;</span>].isin([<span class="number">23.53</span>, <span class="number">23.85</span>])]</span><br></pre></td></tr></table></figure>

<h2 id="统计运算-1"><a href="#统计运算-1" class="headerlink" title="统计运算"></a><code>统计运算</code></h2><blockquote>
<p>Numpy当中已经详细介绍，在这里主要有如下的函数需要了解：</p>
<p>min(最小值), max(最大值), mean(平均值), median(中位数), var(方差), std(标准差),mode(众数)</p>
<ul>
<li><p>DataFram.describe(): 综合分析函数，能够得出很多结果，如平均值，标准差，最大值，最小值</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240824163141264.png" alt="image-20240824163141264"></p>
</li>
<li><p>DataFram.max(0&#x2F;1)：求DataFram中的最大值，使用位置参数axis，0代表按照列统计，1按照行统计</p>
</li>
<li><p>DataFrame.var(0&#x2F;1)：方差</p>
</li>
<li><p>DataFrame.std(0&#x2F;1)：标准差</p>
</li>
<li><p>DataFrame.median(0&#x2F;1)：中位数</p>
</li>
<li><p>DataFream.idxmax(0&#x2F;1)：最大值的下标</p>
</li>
<li><p>DataFrame.idxmin(0&#x2F;1)：最小值的下标</p>
</li>
</ul>
<p>cum系列函数，在 Pandas 中，<code>cumsum()</code> 是一个用于计算累积和（cumulative sum）的方法。它可以对 <code>Series</code> 或 <code>DataFrame</code> 对象中的数据进行逐步累加，返回一个新的 <code>Series</code> 或 <code>DataFrame</code>，其中每个元素是原始数据的累积和。</p>
<ul>
<li>Series.cumsum()：对Series中的数值进行累加</li>
</ul>
<p>cum系列函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>cumsum</code></td>
<td><strong>计算前1&#x2F;2&#x2F;3&#x2F;…&#x2F;n个数的和</strong></td>
</tr>
<tr>
<td><code>cummax</code></td>
<td>计算前1&#x2F;2&#x2F;3&#x2F;…&#x2F;n个数的最大值</td>
</tr>
<tr>
<td><code>cummin</code></td>
<td>计算前1&#x2F;2&#x2F;3&#x2F;…&#x2F;n个数的最小值</td>
</tr>
<tr>
<td><code>cumprod</code></td>
<td>计算前1&#x2F;2&#x2F;3&#x2F;…&#x2F;n个数的积</td>
</tr>
</tbody></table>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt   </span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;./stock_day.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"><span class="comment"># 数据太多没有用的列了，需要裁剪一些字段</span></span><br><span class="line">data = data.drop([<span class="string">&quot;ma5&quot;</span>,<span class="string">&quot;ma10&quot;</span>,<span class="string">&quot;ma20&quot;</span>,<span class="string">&quot;v_ma5&quot;</span>,<span class="string">&quot;v_ma10&quot;</span>,<span class="string">&quot;v_ma20&quot;</span>], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 紧接上面的逻辑运算，这里是统计运算</span></span><br><span class="line"><span class="comment"># 统计运算就是求count，中位数，平均数，最大值，最小值等一系列数学上的数值</span></span><br><span class="line">data.describe()  </span><br><span class="line"></span><br><span class="line"><span class="comment"># Numpy当中已经详细介绍，在这里主要练习min(最小值), max(最大值), mean(平均值), median(中位数), var(方差), std(标准差),mode(众数)结果</span></span><br><span class="line"><span class="comment"># 对于单个函数去进行统计的时候，可以指定是x轴，还是y轴（也就是按照数据的行或者列进行统计） axis=0代表按照列统计，axis=1代表按行统计</span></span><br><span class="line">data.<span class="built_in">max</span>(<span class="number">1</span>)  <span class="comment"># 0 代表列求结果， 1 代表行求统计结果, 其实这里的参数为缺省参数，少了axis=</span></span><br><span class="line">data.var(<span class="number">1</span>)  <span class="comment"># 求方差，对每一列求</span></span><br><span class="line">data.std(<span class="number">0</span>)  <span class="comment"># 标准差</span></span><br><span class="line">data.median(<span class="number">0</span>) <span class="comment"># 求中位数</span></span><br><span class="line">data.idxmax(<span class="number">0</span>) <span class="comment"># 找出最大值的位置</span></span><br><span class="line">data.idxmin(axis=<span class="number">0</span>) <span class="comment"># 找出最小值的位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cum系列函数(cumsum 计算1/2/3..n个数的和，就是累加，cummax 计算前n个数的最大值，cummin计算前n个数的最小值，cumprod计算前n个数的乘积)</span></span><br><span class="line">data = data.sort_index()</span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line">stock_rise = data[<span class="string">&#x27;p_change&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(stock_rise)</span><br><span class="line">stock_rise.cumsum()  <span class="comment"># 对data中的p_change这一列数据进行连续求和操作，通过matplotlib能更加直观的反应</span></span><br><span class="line">stock_rise.cumsum().plot()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义运算（定义一个列中最大值-最小值的函数）apply(func, axis=0) func是自定义函数，axis是列</span></span><br><span class="line">data[[<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;close&#x27;</span>]].apply(<span class="keyword">lambda</span> x: x.<span class="built_in">max</span>() -x.<span class="built_in">min</span>(), axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>



<h2 id="自定义运算apply"><a href="#自定义运算apply" class="headerlink" title="自定义运算apply"></a><code>自定义运算apply</code></h2><ul>
<li>apply(func, axis&#x3D;0)<ul>
<li>func:自定义函数</li>
<li>axis&#x3D;0:默认是列，axis&#x3D;1为行进行运算</li>
</ul>
</li>
<li>定义一个对列，最大值-最小值的函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用apply接口，通过编写匿名函数Lambda作为apply接口的参数</span></span><br><span class="line"><span class="comment"># Lambda函数：定义Series的最大值减去最小值</span></span><br><span class="line"><span class="comment"># 整体：求open列和close列两列的最大值和最小值的差值</span></span><br><span class="line">data[[<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;close&#x27;</span>]].apply(<span class="keyword">lambda</span> x: x.<span class="built_in">max</span>() - x.<span class="built_in">min</span>(), axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>     <span class="number">22.74</span></span><br><span class="line">close    <span class="number">22.85</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<h1 id="Pandas绘图"><a href="#Pandas绘图" class="headerlink" title="Pandas绘图"></a>Pandas绘图</h1><blockquote>
<p>由于之前搞了Matplotlib的画图，但是没有说Pandas本身也能绘图，类似的还有Seaborn绘图，Pyecharts绘图</p>
</blockquote>
<h2 id="DataFrame绘图"><a href="#DataFrame绘图" class="headerlink" title="DataFrame绘图"></a>DataFrame绘图</h2><p><code>DataFrame.plot</code>(<em>kind&#x3D;’line’</em>)</p>
<ul>
<li><p>kind : str，需要绘制图形的种类</p>
</li>
<li><p><strong>‘line’ : line plot (default)</strong></p>
</li>
<li><p>‘bar’ : vertical bar plot</p>
</li>
<li><p>‘barh’ : horizontal bar plot</p>
</li>
<li><p>‘hist’ : histogram</p>
</li>
<li><p>‘pie’ : pie plot</p>
</li>
<li><p>‘scatter’ : scatter plot</p>
</li>
</ul>
<blockquote>
<p>更多信息：<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.plot.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.plot.html</a></p>
</blockquote>
<h2 id="Series绘图"><a href="#Series绘图" class="headerlink" title="Series绘图"></a>Series绘图</h2><blockquote>
<p>更多信息：<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.plot.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.plot.html</a></p>
</blockquote>
<h1 id="文件读取与存储"><a href="#文件读取与存储" class="headerlink" title="文件读取与存储"></a>文件读取与存储</h1><p>Pandas的API支持众多的文件格式，如CSV、SQL、XLS、JSON、HDF5</p>
<h2 id="csv、tsv文件"><a href="#csv、tsv文件" class="headerlink" title="csv、tsv文件"></a>csv、tsv文件</h2><blockquote>
<p>csv文件就是字段之间comma(逗号)分割，每条数据\n换行的格式文件；而tsv文件则是以\t作为字段之间分割，每条数据\n换行的格式文件。</p>
<ul>
<li>pandas.read_csv(filepath_or_buffer, sep &#x3D;’,’, usecols )<ul>
<li>pandas可以简写为pd(前提是import pandas as pd)</li>
</ul>
</li>
<li>DataFrame.to_csv(path_or_buf&#x3D;None, sep&#x3D;’, ’, columns&#x3D;None, header&#x3D;True, index&#x3D;True, mode&#x3D;’w’, encoding&#x3D;None)<ul>
<li>header :boolean or list of string, default True,是否写进列索引值</li>
<li>index:是否写进行索引</li>
<li>mode:’w’：重写, ‘a’ 追加</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># pandas的API支持众多的文件格式，如CSV、SQL、XLS、JSON、HDF5。</span></span><br><span class="line"><span class="comment"># 读取csv文件（就是comma-逗号分割的一种文件）</span></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;./stock_day.csv&#x27;</span>, usecols=[<span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;close&#x27;</span>])  <span class="comment"># 读取文件，且指定获取open和close的指标</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将DataFrame写出为csv文件，可选参数path_or_buf 文件路径，index：是否写进行索引，mode：w代表重写，a代表追加，sep：分割符</span></span><br><span class="line"><span class="comment"># DataFrame.to_csv(path_or_buf=None, sep=&#x27;, ’, columns=None, header=True, index=True, mode=&#x27;w&#x27;, encoding=None)</span></span><br><span class="line">data[:<span class="number">10</span>].to_csv(<span class="string">&#x27;./test.csv&#x27;</span>, columns=[<span class="string">&#x27;open&#x27;</span>])  <span class="comment"># 保存open列的数据，选取10行数据保存，便于观察数据</span></span><br><span class="line">pd.read_csv(<span class="string">&quot;./test.csv&quot;</span>)</span><br><span class="line"><span class="comment"># 	Unnamed: 0	open</span></span><br><span class="line"><span class="comment"># 0	2018-02-27	23.53</span></span><br><span class="line"><span class="comment"># 1	2018-02-26	22.80</span></span><br><span class="line"><span class="comment"># 2	2018-02-23	22.88</span></span><br><span class="line"><span class="comment"># 3	2018-02-22	22.25</span></span><br></pre></td></tr></table></figure>



<h2 id="Json文件"><a href="#Json文件" class="headerlink" title="Json文件"></a>Json文件</h2><blockquote>
<p>JSON是我们常用的一种数据交换格式，前面在前后端的交互经常用到，也会在存储的时候选择这种格式。所以我们需要知道Pandas如何进行读取和存储JSON格式。</p>
<ul>
<li><p><code>pandas.read_json(path_or_buf=None, orient=None, typ=&#39;frame&#39;, lines=False)</code></p>
<ul>
<li><p>orient : string,Indication of expected JSON string format.</p>
<ul>
<li><p>‘split’ : dict like {index -&gt; [index], columns -&gt; [columns], data -&gt; [values]}</p>
<ul>
<li>split 将索引总结到索引，列名到列名，数据到数据。将三部分都分开了</li>
</ul>
</li>
<li><p>‘records’ : list like [{column -&gt; value}, … , {column -&gt; value}]</p>
<ul>
<li>records 以<code>columns：values</code>的形式输出</li>
</ul>
</li>
<li><p>‘index’ : dict like {index -&gt; {column -&gt; value}}</p>
<ul>
<li>index 以<code>index：&#123;columns：values&#125;...</code>的形式输出</li>
</ul>
</li>
<li><p>‘columns’ : dict like {column -&gt; {index -&gt; value}}</p>
<p>,默认该格式</p>
<ul>
<li>colums 以<code>columns:&#123;index:values&#125;</code>的形式输出</li>
</ul>
</li>
<li><p>‘values’ : just the values array</p>
<ul>
<li>values 直接输出值</li>
</ul>
</li>
</ul>
</li>
<li><p>lines : boolean, default False</p>
<ul>
<li>按照每行读取json对象</li>
</ul>
</li>
<li><p>typ : default ‘frame’， 指定转换成的对象类型series或者dataframe</p>
</li>
</ul>
</li>
<li><p><code>DataFrame.to_json(path_or_buf=None, orient=None, lines=False)</code></p>
<ul>
<li>将Pandas 对象存储为json格式</li>
<li><em>path_or_buf&#x3D;None</em>：文件地址</li>
<li>orient:存储的json形式，{‘split’,’records’,’index’,’columns’,’values’}</li>
<li>lines:一个对象存储为一行</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将JSON格式准换成默认的Pandas DataFrame格式</span></span><br><span class="line"><span class="comment"># 读取json文件,orient是指定存储的json格式, lines指定为True是按照行去读取，以行为单位为一个样本</span></span><br><span class="line">json_read = pd.read_json(<span class="string">&#x27;./Sarcasm_Headlines_Dataset.json&#x27;</span>, orient=<span class="string">&#x27;records&#x27;</span>, lines=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(json_read)</span><br><span class="line"><span class="comment"># 写出csv文件:DataFrame.to_json(*path_or_buf=None*, *orient=None*, *lines=False*)</span></span><br><span class="line"><span class="comment"># orient: 存储json的格式，常见的有split，records，index，columns，values</span></span><br><span class="line"><span class="comment"># lines: 一个对象存储为一行</span></span><br><span class="line">json_read.to_json(<span class="string">&#x27;./test.json&#x27;</span>, orient=<span class="string">&#x27;records&#x27;</span>)  <span class="comment"># 如果没有指定lines，则不是按照每个对象存储一行，则会导致出现一行很长的数据</span></span><br><span class="line">json_read.to_json(<span class="string">&#x27;./test.json&#x27;</span>, orient=<span class="string">&#x27;records&#x27;</span>, lines=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h2 id="HDF5文件"><a href="#HDF5文件" class="headerlink" title="HDF5文件"></a>HDF5文件</h2><blockquote>
<p>Python跟HDF5文件交互需要使用到一个Tables依赖包，如果没有的话pip install tables</p>
<p><strong>HDF5文件的读取和存储需要指定一个键，值为要存储的DataFrame</strong></p>
<ul>
<li>pandas.read_hdf(path_or_buf，key &#x3D;None，** kwargs)<ul>
<li>path_or_buffer:文件路径</li>
<li>key:读取的键</li>
<li>return:Theselected object</li>
</ul>
</li>
<li>DataFrame.to_hdf(path_or_buf, <em>key</em>, ***kwargs*)</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="缺失值处理"><a href="#缺失值处理" class="headerlink" title="缺失值处理"></a>缺失值处理</h1><blockquote>
<p>对于缺失值处理，需要掌握的东西：</p>
<ul>
<li>应用isnull判断是否有缺失数据NaN<ul>
<li>pd.notnull(movie)<ul>
<li>标记DataFrame(movie)中不是Nan的为True，为Nan(空值)的为False</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240826223649949.png" alt="image-20240826223649949"></p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240826223708608.png" alt="image-20240826223708608"></p>
<ul>
<li><p>pd.isnull(movie)</p>
<ul>
<li>跟notnull相反</li>
</ul>
</li>
<li><p>应用fillna实现缺失值的填充</p>
<ul>
<li>movie[‘Revenue (Millions)’].fillna(movie[‘Revenue (Millions)’].mean(), inplace&#x3D;True) <ul>
<li>给税收这一列的所有nan值填充中位数</li>
</ul>
</li>
<li><code>替换所有的缺失值,有三步很重要的步骤</code><ul>
<li>movie.columns</li>
<li>if np.all(pd.notnull(movie[i])) &#x3D;&#x3D; False</li>
<li>movie[i].fillna(movie[i].mean(), inplace&#x3D;True)</li>
</ul>
</li>
</ul>
</li>
<li><p>应用dropna实现缺失值的删除</p>
<ul>
<li>DataFrame.dropna()：会直接删除Nan值所在的行</li>
</ul>
</li>
</ul>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240826223731473.png" alt="image-20240826223731473"></p>
<ul>
<li>应用replace实现数据的替换<ul>
<li>wis &#x3D; wis.replace(to_replace&#x3D;”?”, value&#x3D;np.nan)：先将？替换成nan类型的空值</li>
<li>wis &#x3D; wis.dropna()：删除nan类型的空值</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取电影文件</span></span><br><span class="line">movie = pd.read_csv(<span class="string">&#x27;./IMDB-Movie-Data.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># 判断缺失值是否存在</span></span><br><span class="line">pd.notnull(movie)  <span class="comment"># 会将DataFrame中不为空值的标记为True，反之为空则为False</span></span><br><span class="line">pd.isnull(movie)  <span class="comment"># 跟notnull相反</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># numpy 结合pandas，np.all()判断numpy数组是否全部是True</span></span><br><span class="line">np.<span class="built_in">all</span>(pd.notnull(movie))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺失值是nan标记的处理方式</span></span><br><span class="line"><span class="comment"># pandas删除缺失值，使用dropna的前提是，缺失值的类型必须是np.nan</span></span><br><span class="line">movie.dropna()  <span class="comment"># 不修改原数据(在原来基础上新的DataFrame，可以用新的变量来接收他)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pandas替换缺失值，分两种情况(填充用平均数，中位数)</span></span><br><span class="line">movie[<span class="string">&#x27;Revenue (Millions)&#x27;</span>].fillna(movie[<span class="string">&#x27;Revenue (Millions)&#x27;</span>].mean(), inplace=<span class="literal">True</span>)  <span class="comment"># 给税收这一列的所有nan值填充中位数</span></span><br><span class="line"><span class="comment"># 替换所有缺失值，movie.columns获取所有的列，np.all(pd.notnull(df[列]))：判断该列是否存在nan值，最后一步是替换fillna(mean, inplace=True)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> movie.columns:</span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">all</span>(pd.notnull(movie[i])) == <span class="literal">False</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        movie[i].fillna(movie[i].mean(), inplace=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 缺失值不是nan的标记方式（不是nan就先替换为nan，是nan就替换）</span></span><br><span class="line"><span class="comment"># wis = pd.read_csv(&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data&quot;)</span></span><br><span class="line"><span class="comment"># 如果上面读取报错 需要进行全局取消证书验证</span></span><br><span class="line"><span class="comment"># 全局取消证书验证</span></span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line">wis = pd.read_csv(<span class="string">&quot;https://archive.ics.uci.edu/ml/machine-learning-databases/breast-cancer-wisconsin/breast-cancer-wisconsin.data&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先把不是nan的替换成nan，然后df.dropna()</span></span><br><span class="line">wis = wis.replace(to_replace=<span class="string">&quot;?&quot;</span>, value=np.nan)</span><br><span class="line"><span class="comment"># 删除nan</span></span><br><span class="line">wis = wis.dropna()</span><br></pre></td></tr></table></figure>



<h1 id="数据离散化"><a href="#数据离散化" class="headerlink" title="数据离散化"></a>数据离散化</h1><blockquote>
<p>数据离散化：连续属性的离散化就是在连续属性的值域上，将值域划分为若干个离散的区间，最后用不同的符号或整数 值代表落在每个子区间中的属性值。</p>
<p>举个例子：我们一般会将2000年出生到2009年出生的叫00后，1990-1999年生人为90后，就是聚类的问题。</p>
<ul>
<li>qcut &#x3D; pd.qcut(p_change, 10)<ul>
<li>对p_change这个DataFrame进行分组，分10个组，这个程序自己根据数据来分类的，每类数据都差不多</li>
</ul>
</li>
<li>qcut.value_counts():<ul>
<li>计算分到每个组的数据个数</li>
</ul>
</li>
<li>pd.cut(p_change, bins)<ul>
<li>根据前面那自定的bins区间进行分组（以bins作为分组依据），bins是一个列表，两两为一组</li>
</ul>
</li>
<li><code>独热编码</code><ul>
<li>pandas.get_dummies(data, prefix&#x3D;None)<ul>
<li>对DataFrame(data)获取独热编码，prefix前缀其实就是分组名称</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240828221821210.png" alt="image-20240828221821210"></p>
<ul>
<li>自己总结：<ul>
<li>独热编码其实你有多少个类别的数据，就会有多少个列去唯一标识这些类别（慢慢体会吧，后面忘了再回顾</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;./stock_day.csv&#x27;</span>)</span><br><span class="line">p_change = data[<span class="string">&#x27;p_change&#x27;</span>]</span><br><span class="line"><span class="comment"># 让Pandas对数据进行分组（一般会与value_counts）搭配使用，这种情况分组会</span></span><br><span class="line">qcut = pd.qcut(p_change, <span class="number">10</span>)</span><br><span class="line"><span class="comment"># print(qcut)</span></span><br><span class="line"><span class="comment"># 分组情况：Categories (10, interval[float64, right]): [(-10.030999999999999, -4.836] &lt; (-4.836, -2.444] &lt; (-2.444, -1.352] &lt; (-1.352, -0.462] ... (0.94, 1.738] &lt; (1.738, 2.938] &lt; (2.938, 5.27] &lt; (5.27, 10.03]]</span></span><br><span class="line"><span class="comment"># 计算分到每个分组数据个数</span></span><br><span class="line">qcut.value_counts()</span><br><span class="line"><span class="comment"># (-10.030999999999999, -4.836]    65</span></span><br><span class="line"><span class="comment"># (-0.462, 0.26]                   65</span></span><br><span class="line"><span class="comment"># (0.26, 0.94]                     65</span></span><br><span class="line"><span class="comment"># (5.27, 10.03]                    65</span></span><br><span class="line"><span class="comment"># (-4.836, -2.444]                 64</span></span><br><span class="line"><span class="comment"># (-2.444, -1.352]                 64</span></span><br><span class="line"><span class="comment"># (-1.352, -0.462]                 64</span></span><br><span class="line"><span class="comment"># (1.738, 2.938]                   64</span></span><br><span class="line"><span class="comment"># (2.938, 5.27]                    64</span></span><br><span class="line"><span class="comment"># (0.94, 1.738]                    63</span></span><br><span class="line"><span class="comment"># 自定义区间分组 pd.cut(data, bins) </span></span><br><span class="line">bins = [-<span class="number">100</span>, -<span class="number">7</span>, -<span class="number">5</span>, -<span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">100</span>]  <span class="comment"># 自己指定分组区间</span></span><br><span class="line"><span class="comment"># 以bins作为分组的依据</span></span><br><span class="line">p_counts = pd.cut(p_change, bins)</span><br><span class="line"><span class="built_in">print</span>(p_counts)</span><br><span class="line"><span class="comment"># 2018-02-27      (0, 3]</span></span><br><span class="line"><span class="comment"># 2018-02-26      (3, 5]</span></span><br><span class="line"><span class="comment"># 2018-02-23      (0, 3]</span></span><br><span class="line"><span class="comment"># 2018-02-22      (0, 3]</span></span><br><span class="line"><span class="comment"># 2018-02-14      (0, 3]</span></span><br><span class="line"><span class="comment">#                 ...   </span></span><br><span class="line"><span class="comment"># 2015-03-06    (7, 100]</span></span><br><span class="line"><span class="comment"># 2015-03-05      (0, 3]</span></span><br><span class="line"><span class="comment"># 2015-03-04      (0, 3]</span></span><br><span class="line"><span class="comment"># 2015-03-03      (0, 3]</span></span><br><span class="line"><span class="comment"># 2015-03-02      (0, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 独热编码（简单理解就是对数据进行分类，然后把每个类别生成一个布尔列，这些列中只有一列可以为这个样本取值为1，这些编码方式被称为独热编码</span></span><br><span class="line"><span class="comment"># pandas.get_dummies(data, prefix=None)</span></span><br><span class="line">dummies = pd.get_dummies(p_counts, prefix=<span class="string">&quot;rise&quot;</span>)  <span class="comment"># 得出one-hot编码矩阵，prefix是分组名字</span></span><br></pre></td></tr></table></figure>



<h1 id="数据处理-合并"><a href="#数据处理-合并" class="headerlink" title="数据处理-合并"></a>数据处理-合并</h1><blockquote>
<ul>
<li>pd.concat([df1, df2], axis &#x3D; 0&#x2F;1)<ul>
<li>这种就是对两个DataFrame进行简单的拼接，axis中0为列索引，1为行索引</li>
</ul>
</li>
<li>pd.merge(left, right, how&#x3D;”inner”, on&#x3D;None)<ul>
<li>可以按照两组数据的共同键值对合并或者左右各自，how可以进行内连接，左外，右外，on为外键</li>
</ul>
</li>
</ul>
<p>内连接：</p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240902215941594.png" alt="image-20240902215941594"></p>
<p><strong>左连接：</strong></p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240902220025534.png" alt="image-20240902220025534"></p>
<p><strong>右连接：</strong></p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240902220058267.png" alt="image-20240902220058267"></p>
<p><strong>外连接：</strong></p>
<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240902220121844.png" alt="image-20240902220121844"></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据合并的两个函数分别是pd.merge和pd.concat</span></span><br><span class="line"><span class="comment"># pd.concat([df1, df2], axis=0/1)  # 按照行/列对两个DataFrame进行合并，0为列索引，1为行索引</span></span><br><span class="line"><span class="comment"># pd.merge(left, right, how=&quot;inner&quot;, on=None)  # 可以按照两组数据的共同键值对合并或者左右各自，how可以进行内连接，左外，右外，on为外键</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照行索引进行</span></span><br><span class="line">pd.concat([data, dummies], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pd.merge</span></span><br><span class="line">left = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K2&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;key2&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;A1&#x27;</span>, <span class="string">&#x27;A2&#x27;</span>, <span class="string">&#x27;A3&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;B1&#x27;</span>, <span class="string">&#x27;B2&#x27;</span>, <span class="string">&#x27;B3&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K2&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;key2&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K0&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;C&#x27;</span>: [<span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;C1&#x27;</span>, <span class="string">&#x27;C2&#x27;</span>, <span class="string">&#x27;C3&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;D&#x27;</span>: [<span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;D1&#x27;</span>, <span class="string">&#x27;D2&#x27;</span>, <span class="string">&#x27;D3&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认内连接</span></span><br><span class="line">result = pd.merge(left, right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])  <span class="comment"># 以key1和key2为连接主键</span></span><br><span class="line"><span class="comment"># 左连接</span></span><br><span class="line">result = pd.merge(left, right, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;key1&#x27;</span>,<span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># 右连接</span></span><br><span class="line">result = pd.merge(left, right, how = <span class="string">&#x27;right&#x27;</span>, on = [<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># 外连接(其实是满外连接)</span></span><br><span class="line">result = pd.merge(left, right, how=<span class="string">&#x27;outer&#x27;</span>, on=[<span class="string">&#x27;key1&#x27;</span>,<span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>



<h1 id="交叉表与透视表-1"><a href="#交叉表与透视表-1" class="headerlink" title="交叉表与透视表"></a>交叉表与透视表</h1><blockquote>
<p>应用crosstab和pivot_table实现交叉表与透视表</p>
<ul>
<li><p>交叉表：</p>
<p>交叉表用于计算一列数据对于另外一列数据的分组个数(用于统计分组频率的特殊透视表)</p>
<ul>
<li>pd.crosstab(value1, value2)</li>
</ul>
</li>
<li><p>透视表：</p>
<p>透视表是将原有的DataFrame的列分别作为行索引和列索引，然后对指定的列应用聚集函数</p>
<ul>
<li>data.pivot_table(）</li>
<li>DataFrame.pivot_table([], index&#x3D;[])</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># 寻找星期几跟股票涨跌的关系</span></span><br><span class="line"><span class="comment"># 1, 先把对应的日期找到星期几(data.index实际上是[&#x27;2018-02-27&#x27;, &#x27;2018-02-26&#x27;]列索引组成的列表，pd.to_datetime(df)是将df中的数据全部转为datetime64类型)</span></span><br><span class="line">date = pd.to_datetime(data.index).weekday  <span class="comment"># df.weekday 是将dataframe中  的日期转为周几0-6</span></span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;week&#x27;</span>] = date  <span class="comment"># 将date这个DataFrame给data扩充一列，实际打印发现雀实</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2, 把p_change按照大小去分个类，0为界限</span></span><br><span class="line">data[<span class="string">&#x27;posi_neg&#x27;</span>] = np.where(data[<span class="string">&#x27;p_change&#x27;</span>] &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"><span class="comment"># data这个DataFrame产生了两列数据</span></span><br><span class="line"><span class="comment">#             week  posi_neg  </span></span><br><span class="line"><span class="comment"># 2018-02-27     1         1  </span></span><br><span class="line"><span class="comment"># 2018-02-26     0         1  </span></span><br><span class="line"><span class="comment"># 2018-02-23     4         1  </span></span><br><span class="line"><span class="comment"># 2018-02-22     3         1  </span></span><br><span class="line"><span class="comment"># 2018-02-14     2         1  </span></span><br><span class="line"><span class="comment"># ...          ...       ...  </span></span><br><span class="line"><span class="comment"># 2015-03-06     4         1  </span></span><br><span class="line"><span class="comment"># 2015-03-05     3         1  </span></span><br><span class="line"><span class="comment"># 2015-03-04     2         1  </span></span><br><span class="line"><span class="comment"># 2015-03-03     1         1  </span></span><br><span class="line"><span class="comment"># 2015-03-02     0         1  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过交叉表找寻两列数据的关系</span></span><br><span class="line">count = pd.crosstab(data[<span class="string">&#x27;week&#x27;</span>], data[<span class="string">&#x27;posi_neg&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(count)</span><br><span class="line"><span class="comment"># 但是我们看到count只是每个星期日子的好坏天数，并没有得到比例，可以对每个星期一的总天数求和，运用除法运算求出比例</span></span><br><span class="line"><span class="comment"># 算数运算，先求和</span></span><br><span class="line"><span class="built_in">sum</span> = count.<span class="built_in">sum</span>(axis=<span class="number">1</span>).astype(np.float32)</span><br><span class="line"><span class="comment"># 除以总数得出比例</span></span><br><span class="line">pro = count.div(<span class="built_in">sum</span>, axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用plot画图，使用stacked的柱状图来查看效果</span></span><br><span class="line">pro.plot(kind=<span class="string">&#x27;bar&#x27;</span>, stacked=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用pivot_table实现</span></span><br><span class="line"><span class="comment"># 通过透视表，使得刚才的过程更简单一些</span></span><br><span class="line">data.pivot_table([<span class="string">&#x27;posi_neg&#x27;</span>], index=<span class="string">&#x27;week&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="分组与聚合"><a href="#分组与聚合" class="headerlink" title="分组与聚合"></a>分组与聚合</h1><blockquote>
<p>应用groupby和聚合函数实现数据的分组与聚合</p>
</blockquote>
<ul>
<li>DataFrame.groupby(key, as_index&#x3D;False)<ul>
<li>key:分组的列数据，可以多个</li>
</ul>
</li>
<li>案例:不同颜色的不同笔的价格数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">col =pd.DataFrame(&#123;<span class="string">&#x27;color&#x27;</span>: [<span class="string">&#x27;white&#x27;</span>,<span class="string">&#x27;red&#x27;</span>,<span class="string">&#x27;green&#x27;</span>,<span class="string">&#x27;red&#x27;</span>,<span class="string">&#x27;green&#x27;</span>], <span class="string">&#x27;object&#x27;</span>: [<span class="string">&#x27;pen&#x27;</span>,<span class="string">&#x27;pencil&#x27;</span>,<span class="string">&#x27;pencil&#x27;</span>,<span class="string">&#x27;ashtray&#x27;</span>,<span class="string">&#x27;pen&#x27;</span>],<span class="string">&#x27;price1&#x27;</span>:[<span class="number">5.56</span>,<span class="number">4.20</span>,<span class="number">1.30</span>,<span class="number">0.56</span>,<span class="number">2.75</span>],<span class="string">&#x27;price2&#x27;</span>:[<span class="number">4.75</span>,<span class="number">4.12</span>,<span class="number">1.60</span>,<span class="number">0.75</span>,<span class="number">3.15</span>]&#125;)</span><br><span class="line"></span><br><span class="line">color    <span class="built_in">object</span>    price1    price2</span><br><span class="line"><span class="number">0</span>    white    pen    <span class="number">5.56</span>    <span class="number">4.75</span></span><br><span class="line"><span class="number">1</span>    red    pencil    <span class="number">4.20</span>    <span class="number">4.12</span></span><br><span class="line"><span class="number">2</span>    green    pencil    <span class="number">1.30</span>    <span class="number">1.60</span></span><br><span class="line"><span class="number">3</span>    red    ashtray    <span class="number">0.56</span>    <span class="number">0.75</span></span><br><span class="line"><span class="number">4</span>    green    pen    <span class="number">2.75</span>    <span class="number">3.15</span></span><br></pre></td></tr></table></figure>

<ul>
<li>进行分组，对颜色分组，price进行聚合</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组，求平均值</span></span><br><span class="line">col.groupby([<span class="string">&#x27;color&#x27;</span>])[<span class="string">&#x27;price1&#x27;</span>].mean()</span><br><span class="line">col[<span class="string">&#x27;price1&#x27;</span>].groupby(col[<span class="string">&#x27;color&#x27;</span>]).mean()</span><br><span class="line"></span><br><span class="line">color</span><br><span class="line">green    <span class="number">2.025</span></span><br><span class="line">red      <span class="number">2.380</span></span><br><span class="line">white    <span class="number">5.560</span></span><br><span class="line">Name: price1, dtype: float64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组，数据的结构不变</span></span><br><span class="line">col.groupby([<span class="string">&#x27;color&#x27;</span>], as_index=<span class="literal">False</span>)[<span class="string">&#x27;price1&#x27;</span>].mean()</span><br><span class="line"></span><br><span class="line">color    price1</span><br><span class="line"><span class="number">0</span>    green    <span class="number">2.025</span></span><br><span class="line"><span class="number">1</span>    red    <span class="number">2.380</span></span><br><span class="line"><span class="number">2</span>    white    <span class="number">5.560</span></span><br></pre></td></tr></table></figure>

<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入星巴克数据</span></span><br><span class="line">starbucks = pd.read_csv(<span class="string">&#x27;./directory.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># 按照国家分组，求出每个国家的星巴克零售店数量，先分组，再聚合</span></span><br><span class="line">count = starbucks.groupby([<span class="string">&#x27;Country&#x27;</span>]).count()</span><br><span class="line"></span><br><span class="line">count[<span class="string">&#x27;Brand&#x27;</span>].plot(kind=<span class="string">&#x27;bar&#x27;</span>,figsize=(<span class="number">20</span>,<span class="number">8</span>))</span><br><span class="line">plt.show()</span><br><span class="line"><span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入省市一起分租</span></span><br><span class="line">multi = starbucks.groupby([<span class="string">&#x27;Country&#x27;</span>,<span class="string">&#x27;State/Province&#x27;</span>]).count()</span><br><span class="line"><span class="built_in">print</span>(multi)</span><br></pre></td></tr></table></figure>

<p><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/image-20240902222323642.png" alt="image-20240902222323642"></p>
<p>End.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://liamjohnson-w.github.io">Jason</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://liamjohnson-w.github.io/2024/08/12/2024.08.12/">https://liamjohnson-w.github.io/2024/08/12/2024.08.12/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/%E7%A7%91%E5%AD%A6%E5%BA%93/">科学库</a></div><div class="post_share"><div class="social-share" data-image="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/tx.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/02/2024.09.02/" title="【安卓逆向】环境搭建"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">【安卓逆向】环境搭建</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/08/2024.08.08/" title="【MarkDown】Latex语法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">【MarkDown】Latex语法</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/07/31/2024.07.31/" title="【Matplotlib】数据可视化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-31</div><div class="title">【Matplotlib】数据可视化</div></div></a></div><div><a href="/2024/08/02/2024.08.02/" title="【Numpy】高效科学计算"><img class="cover" src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/pics%20(3).png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-02</div><div class="title">【Numpy】高效科学计算</div></div></a></div><div><a href="/2020/06/07/2020-06-07/" title="基于Python的Socket服务器和客户端通信（Pycharm）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-07</div><div class="title">基于Python的Socket服务器和客户端通信（Pycharm）</div></div></a></div><div><a href="/2020/06/08/2020.06.08/" title="Python爬虫前置配置及Demo"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-08</div><div class="title">Python爬虫前置配置及Demo</div></div></a></div><div><a href="/2020/06/15/2020.06.15/" title="Python面向Socket编程Demo"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-15</div><div class="title">Python面向Socket编程Demo</div></div></a></div><div><a href="/2023/04/12/2023.04.12/" title="Python爬虫回顾(爬报价网)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-12</div><div class="title">Python爬虫回顾(爬报价网)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/tx.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jason</div><div class="author-info__description">机器都在学习,你有什么理由不学习?</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">234</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">58</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/weiswift/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/weiswift" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1265019024@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">博客为本人搭建 Github托管 仅记录学习过程 不做引流 不做排名 不打广告！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Pandas%E8%A1%A5%E5%85%85"><span class="toc-number">1.</span> <span class="toc-text">Pandas补充</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FPandas%E6%A1%88%E4%BE%8B"><span class="toc-number">1.1.</span> <span class="toc-text">⭐️⭐️Pandas案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FSeries"><span class="toc-number">1.2.</span> <span class="toc-text">⭐️⭐️⭐️Series</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.2.1.</span> <span class="toc-text">创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Series%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">Series属性和方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FDataFrame"><span class="toc-number">1.3.</span> <span class="toc-text">⭐️⭐️⭐️DataFrame</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BADataFrame"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建DataFrame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataFrame%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.2.</span> <span class="toc-text">DataFrame属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataFrame%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">DataFrame对象方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DatatFrame%E7%B4%A2%E5%BC%95%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.3.4.</span> <span class="toc-text">DatatFrame索引的设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pandas%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">Pandas数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FPandas%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.</span> <span class="toc-text">⭐️⭐️⭐️Pandas基本数据操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E3%80%81%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.1.</span> <span class="toc-text">读取、写入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E7%B4%A2%E5%BC%95%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.2.</span> <span class="toc-text">⭐️⭐️⭐️索引操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E8%B5%8B%E5%80%BC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.3.</span> <span class="toc-text">⭐️⭐️赋值操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E6%8E%92%E5%BA%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.4.</span> <span class="toc-text">⭐️⭐️排序操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FDataFrame%E8%BF%90%E7%AE%97"><span class="toc-number">1.6.</span> <span class="toc-text">⭐️⭐️DataFrame运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97"><span class="toc-number">1.6.1.</span> <span class="toc-text">算术运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">1.6.2.</span> <span class="toc-text">⭐️⭐️逻辑运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E8%BF%90%E7%AE%97"><span class="toc-number">1.6.3.</span> <span class="toc-text">统计运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%AF%E8%AE%A1%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.6.4.</span> <span class="toc-text">累计统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apply%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.5.</span> <span class="toc-text">apply自定义函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FDataFrame%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.7.</span> <span class="toc-text">⭐️⭐️⭐️DataFrame数据的增删改查操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0"><span class="toc-number">1.7.1.</span> <span class="toc-text">增加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%8E%E5%8E%BB%E9%87%8D"><span class="toc-number">1.7.2.</span> <span class="toc-text">删除与去重</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">1.7.3.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.7.4.</span> <span class="toc-text">查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%A4%84%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">⭐️⭐️⭐️缺失值处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E4%B8%BANAN"><span class="toc-number">1.8.1.</span> <span class="toc-text">缺失值为NAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E6%98%AF%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6"><span class="toc-number">1.8.2.</span> <span class="toc-text">缺失值是特殊字符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6"><span class="toc-number">1.9.</span> <span class="toc-text">数据合并</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#concat"><span class="toc-number">1.9.1.</span> <span class="toc-text">concat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#merge"><span class="toc-number">1.9.2.</span> <span class="toc-text">merge</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E7%BB%84"><span class="toc-number">1.10.</span> <span class="toc-text">数据分组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">1.10.1.</span> <span class="toc-text">分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="toc-number">1.10.2.</span> <span class="toc-text">分组聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%BF%87%E6%BB%A4"><span class="toc-number">1.10.3.</span> <span class="toc-text">分组过滤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%A1%A8%E4%B8%8E%E9%80%8F%E8%A7%86%E8%A1%A8"><span class="toc-number">1.11.</span> <span class="toc-text">交叉表与透视表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%A1%A8"><span class="toc-number">1.11.1.</span> <span class="toc-text">交叉表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%8F%E8%A7%86%E8%A1%A8"><span class="toc-number">1.11.2.</span> <span class="toc-text">透视表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.11.3.</span> <span class="toc-text">案例分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8FPandas%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%E2%AD%90%EF%B8%8F%E2%AD%90%EF%B8%8F"><span class="toc-number">2.</span> <span class="toc-text">⭐️⭐️Pandas综合案例⭐️⭐️</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">2.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDP%E6%A1%88%E4%BE%8B"><span class="toc-number">2.2.</span> <span class="toc-text">GDP案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E8%A1%A3%E5%BA%93%E6%A1%88%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">优衣库案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%AD%90%EF%B8%8FRFM%E6%A1%88%E4%BE%8B%E2%AD%90%EF%B8%8F"><span class="toc-number">3.</span> <span class="toc-text">⭐️RFM案例⭐️</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">需求说明：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.2.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%B8%A6%E8%AF%A6%E7%BB%86%E6%B3%A8%E9%87%8A"><span class="toc-number">3.4.</span> <span class="toc-text">代码带详细注释</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">4.</span> <span class="toc-text">引言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%E8%AE%BA%E8%AF%81"><span class="toc-number">4.1.</span> <span class="toc-text">举例论证</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pandas%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">5.</span> <span class="toc-text">Pandas数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Series"><span class="toc-number">5.1.</span> <span class="toc-text">Series</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DataFrame"><span class="toc-number">5.2.</span> <span class="toc-text">DataFrame</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MultiIndex%E4%B8%8EPanel"><span class="toc-number">5.3.</span> <span class="toc-text">MultiIndex与Panel</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pandas%E7%9A%84%E7%B4%A2%E5%BC%95%E3%80%81%E5%88%87%E7%89%87%E5%9F%BA%E6%93%8D"><span class="toc-number">6.</span> <span class="toc-text">Pandas的索引、切片基操</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%93%8D%E4%BD%9C"><span class="toc-number">6.1.</span> <span class="toc-text">索引操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E6%93%8D%E4%BD%9C"><span class="toc-number">6.2.</span> <span class="toc-text">赋值操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">6.3.</span> <span class="toc-text">排序操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DataFrame%E8%BF%90%E7%AE%97"><span class="toc-number">7.</span> <span class="toc-text">DataFrame运算</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">7.1.</span> <span class="toc-text">算术运算&amp;逻辑运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E8%BF%90%E7%AE%97-1"><span class="toc-number">7.2.</span> <span class="toc-text">统计运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%90%E7%AE%97apply"><span class="toc-number">7.3.</span> <span class="toc-text">自定义运算apply</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pandas%E7%BB%98%E5%9B%BE"><span class="toc-number">8.</span> <span class="toc-text">Pandas绘图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DataFrame%E7%BB%98%E5%9B%BE"><span class="toc-number">8.1.</span> <span class="toc-text">DataFrame绘图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Series%E7%BB%98%E5%9B%BE"><span class="toc-number">8.2.</span> <span class="toc-text">Series绘图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E4%B8%8E%E5%AD%98%E5%82%A8"><span class="toc-number">9.</span> <span class="toc-text">文件读取与存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#csv%E3%80%81tsv%E6%96%87%E4%BB%B6"><span class="toc-number">9.1.</span> <span class="toc-text">csv、tsv文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Json%E6%96%87%E4%BB%B6"><span class="toc-number">9.2.</span> <span class="toc-text">Json文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDF5%E6%96%87%E4%BB%B6"><span class="toc-number">9.3.</span> <span class="toc-text">HDF5文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%A4%84%E7%90%86"><span class="toc-number">10.</span> <span class="toc-text">缺失值处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%A6%BB%E6%95%A3%E5%8C%96"><span class="toc-number">11.</span> <span class="toc-text">数据离散化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86-%E5%90%88%E5%B9%B6"><span class="toc-number">12.</span> <span class="toc-text">数据处理-合并</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%A1%A8%E4%B8%8E%E9%80%8F%E8%A7%86%E8%A1%A8-1"><span class="toc-number">13.</span> <span class="toc-text">交叉表与透视表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E4%B8%8E%E8%81%9A%E5%90%88"><span class="toc-number">14.</span> <span class="toc-text">分组与聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">14.1.</span> <span class="toc-text">案例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/18/Project/" title="Jason Project Demo"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/pusheen1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jason Project Demo"/></a><div class="content"><a class="title" href="/2025/07/18/Project/" title="Jason Project Demo">Jason Project Demo</a><time datetime="2025-07-17T16:00:00.000Z" title="Created 2025-07-18 00:00:00">2025-07-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/16/%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/" title="算法公式推导"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/pusheen2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法公式推导"/></a><div class="content"><a class="title" href="/2025/07/16/%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC/" title="算法公式推导">算法公式推导</a><time datetime="2025-07-15T16:00:00.000Z" title="Created 2025-07-16 00:00:00">2025-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/29/InterviewQuestions/" title="Jason Interview Note"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/pusheen121.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jason Interview Note"/></a><div class="content"><a class="title" href="/2025/06/29/InterviewQuestions/" title="Jason Interview Note">Jason Interview Note</a><time datetime="2025-06-28T16:00:00.000Z" title="Created 2025-06-29 00:00:00">2025-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/22/DK67/" title="DK67双模切换"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/%E7%94%9F%E6%88%90%E7%8C%AB%E5%92%AA%E5%9B%BE%E7%89%87.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DK67双模切换"/></a><div class="content"><a class="title" href="/2025/06/22/DK67/" title="DK67双模切换">DK67双模切换</a><time datetime="2025-06-21T16:00:00.000Z" title="Created 2025-06-22 00:00:00">2025-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/22/NLP_Base/" title="NLP自然语言处理"><img src="https://wei-blog.oss-cn-beijing.aliyuncs.com/24-07/%E7%94%9F%E6%88%90%E7%8C%AB%E5%92%AA%E5%9B%BE%E7%89%87%20(2).png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NLP自然语言处理"/></a><div class="content"><a class="title" href="/2025/06/22/NLP_Base/" title="NLP自然语言处理">NLP自然语言处理</a><time datetime="2025-06-21T16:00:00.000Z" title="Created 2025-06-22 00:00:00">2025-06-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Jason</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to Jason の <a target="_blank" rel="noopener" href="https://www.cnblogs.com/liam-sliversucks/">Blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>